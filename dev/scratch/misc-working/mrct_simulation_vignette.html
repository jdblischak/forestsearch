<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ForestSearch Package">
<meta name="dcterms.date" content="2026-01-29">

<title>MRCT Simulation Functions for ForestSearch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mrct_simulation_vignette_files/libs/clipboard/clipboard.min.js"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/popper.min.js"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mrct_simulation_vignette_files/libs/quarto-html/anchor.min.js"></script>
<link href="mrct_simulation_vignette_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mrct_simulation_vignette_files/libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mrct_simulation_vignette_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mrct_simulation_vignette_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mrct_simulation_vignette_files/libs/bootstrap/bootstrap-8c4b283fe68d871141289ba1f5d31ced.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a></li>
  <li><a href="#data-requirements" id="toc-data-requirements" class="nav-link" data-scroll-target="#data-requirements"><span class="header-section-number">3</span> Data Requirements</a>
  <ul class="collapse">
  <li><a href="#required-variables" id="toc-required-variables" class="nav-link" data-scroll-target="#required-variables"><span class="header-section-number">3.1</span> Required Variables</a>
  <ul class="collapse">
  <li><a href="#core-variables-required" id="toc-core-variables-required" class="nav-link" data-scroll-target="#core-variables-required"><span class="header-section-number">3.1.1</span> Core Variables (Required)</a></li>
  <li><a href="#continuous-covariates-required" id="toc-continuous-covariates-required" class="nav-link" data-scroll-target="#continuous-covariates-required"><span class="header-section-number">3.1.2</span> Continuous Covariates (Required)</a></li>
  <li><a href="#factor-covariates-required" id="toc-factor-covariates-required" class="nav-link" data-scroll-target="#factor-covariates-required"><span class="header-section-number">3.1.3</span> Factor Covariates (Required)</a></li>
  </ul></li>
  <li><a href="#validation-function" id="toc-validation-function" class="nav-link" data-scroll-target="#validation-function"><span class="header-section-number">3.2</span> Validation Function</a></li>
  </ul></li>
  <li><a href="#example-data-preparation" id="toc-example-data-preparation" class="nav-link" data-scroll-target="#example-data-preparation"><span class="header-section-number">4</span> Example Data Preparation</a>
  <ul class="collapse">
  <li><a href="#creating-a-synthetic-df.case-dataset" id="toc-creating-a-synthetic-df.case-dataset" class="nav-link" data-scroll-target="#creating-a-synthetic-df.case-dataset"><span class="header-section-number">4.1</span> Creating a Synthetic df.case Dataset</a></li>
  <li><a href="#preparing-an-existing-dataset" id="toc-preparing-an-existing-dataset" class="nav-link" data-scroll-target="#preparing-an-existing-dataset"><span class="header-section-number">4.2</span> Preparing an Existing Dataset</a></li>
  <li><a href="#examining-the-dataset" id="toc-examining-the-dataset" class="nav-link" data-scroll-target="#examining-the-dataset"><span class="header-section-number">4.3</span> Examining the Dataset</a></li>
  </ul></li>
  <li><a href="#creating-data-generating-mechanisms" id="toc-creating-data-generating-mechanisms" class="nav-link" data-scroll-target="#creating-data-generating-mechanisms"><span class="header-section-number">5</span> Creating Data Generating Mechanisms</a>
  <ul class="collapse">
  <li><a href="#alternative-hypothesis-heterogeneous-effect" id="toc-alternative-hypothesis-heterogeneous-effect" class="nav-link" data-scroll-target="#alternative-hypothesis-heterogeneous-effect"><span class="header-section-number">5.1</span> Alternative Hypothesis (Heterogeneous Effect)</a></li>
  <li><a href="#null-hypothesis-uniform-effect" id="toc-null-hypothesis-uniform-effect" class="nav-link" data-scroll-target="#null-hypothesis-uniform-effect"><span class="header-section-number">5.2</span> Null Hypothesis (Uniform Effect)</a></li>
  <li><a href="#adding-confounder-effects" id="toc-adding-confounder-effects" class="nav-link" data-scroll-target="#adding-confounder-effects"><span class="header-section-number">5.3</span> Adding Confounder Effects</a></li>
  </ul></li>
  <li><a href="#running-simulations" id="toc-running-simulations" class="nav-link" data-scroll-target="#running-simulations"><span class="header-section-number">6</span> Running Simulations</a>
  <ul class="collapse">
  <li><a href="#basic-simulation" id="toc-basic-simulation" class="nav-link" data-scroll-target="#basic-simulation"><span class="header-section-number">6.1</span> Basic Simulation</a></li>
  <li><a href="#configuring-parallel-execution" id="toc-configuring-parallel-execution" class="nav-link" data-scroll-target="#configuring-parallel-execution"><span class="header-section-number">6.2</span> Configuring Parallel Execution</a></li>
  <li><a href="#key-parameters" id="toc-key-parameters" class="nav-link" data-scroll-target="#key-parameters"><span class="header-section-number">6.3</span> Key Parameters</a></li>
  </ul></li>
  <li><a href="#summarizing-results" id="toc-summarizing-results" class="nav-link" data-scroll-target="#summarizing-results"><span class="header-section-number">7</span> Summarizing Results</a>
  <ul class="collapse">
  <li><a href="#summary-tables-with-gt" id="toc-summary-tables-with-gt" class="nav-link" data-scroll-target="#summary-tables-with-gt"><span class="header-section-number">7.1</span> Summary Tables with gt</a></li>
  <li><a href="#accessing-summary-components" id="toc-accessing-summary-components" class="nav-link" data-scroll-target="#accessing-summary-components"><span class="header-section-number">7.2</span> Accessing Summary Components</a></li>
  </ul></li>
  <li><a href="#visualizing-results" id="toc-visualizing-results" class="nav-link" data-scroll-target="#visualizing-results"><span class="header-section-number">8</span> Visualizing Results</a>
  <ul class="collapse">
  <li><a href="#hazard-ratio-distributions" id="toc-hazard-ratio-distributions" class="nav-link" data-scroll-target="#hazard-ratio-distributions"><span class="header-section-number">8.1</span> Hazard Ratio Distributions</a></li>
  <li><a href="#custom-visualizations" id="toc-custom-visualizations" class="nav-link" data-scroll-target="#custom-visualizations"><span class="header-section-number">8.2</span> Custom Visualizations</a></li>
  </ul></li>
  <li><a href="#complete-workflow-example" id="toc-complete-workflow-example" class="nav-link" data-scroll-target="#complete-workflow-example"><span class="header-section-number">9</span> Complete Workflow Example</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info"><span class="header-section-number">10</span> Session Info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MRCT Simulation Functions for ForestSearch</h1>
<p class="subtitle lead">Multi-Regional Clinical Trial Subgroup Identification Simulations</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ForestSearch Package </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 29, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This vignette demonstrates the MRCT (Multi-Regional Clinical Trial) simulation functions in the ForestSearch package. These functions enable simulation studies to evaluate subgroup identification methods in trials with heterogeneous treatment effects across regions.</p>
<p>The key functions covered are:</p>
<ul>
<li><code>validate_mrct_data()</code>: Check dataset requirements</li>
<li><code>create_dgm_for_mrct()</code>: Create data generating mechanisms for MRCT scenarios</li>
<li><code>mrct_region_sims()</code>: Run parallelized simulation studies</li>
<li><code>summaryout_mrct()</code>: Summarize simulation results with gt tables</li>
<li><code>SGplot_estimates()</code>: Visualize hazard ratio distributions</li>
</ul>
</section>
<section id="setup" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forestsearch)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-requirements" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data Requirements</h1>
<section id="required-variables" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="required-variables"><span class="header-section-number">3.1</span> Required Variables</h2>
<p>The MRCT simulation functions require a case dataset (<code>df.case</code>) with the following variables:</p>
<section id="core-variables-required" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="core-variables-required"><span class="header-section-number">3.1.1</span> Core Variables (Required)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 20%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tte</code></td>
<td>Numeric</td>
<td>Time-to-event outcome</td>
</tr>
<tr class="even">
<td><code>event</code></td>
<td>Binary (0/1)</td>
<td>Event indicator (1 = event, 0 = censored)</td>
</tr>
<tr class="odd">
<td><code>treat</code></td>
<td>Binary (0/1)</td>
<td>Treatment indicator (1 = treatment, 0 = control)</td>
</tr>
</tbody>
</table>
</section>
<section id="continuous-covariates-required" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="continuous-covariates-required"><span class="header-section-number">3.1.2</span> Continuous Covariates (Required)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>age</code></td>
<td>Numeric</td>
<td>Patient age (years)</td>
</tr>
<tr class="even">
<td><code>bm</code></td>
<td>Numeric</td>
<td>Biomarker value</td>
</tr>
</tbody>
</table>
</section>
<section id="factor-covariates-required" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="factor-covariates-required"><span class="header-section-number">3.1.3</span> Factor Covariates (Required)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>male</code></td>
<td>Binary (0/1)</td>
<td>Sex indicator (1 = male)</td>
</tr>
<tr class="even">
<td><code>histology</code></td>
<td>Factor/Integer</td>
<td>Tumor histology type</td>
</tr>
<tr class="odd">
<td><code>prior_treat</code></td>
<td>Binary (0/1)</td>
<td>Prior treatment indicator</td>
</tr>
<tr class="even">
<td><code>regA</code></td>
<td>Binary (0/1)</td>
<td>Region A indicator (for train/test split)</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="validation-function" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="validation-function"><span class="header-section-number">3.2</span> Validation Function</h2>
<p>The following helper function validates that <code>df.case</code> contains all required variables and reports any issues:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Validate Dataset for MRCT Simulations</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Checks that a dataset contains all required variables for MRCT simulation</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' functions and reports any issues.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df.case Data frame to validate</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param verbose Logical. Print detailed validation results. Default: TRUE</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Logical. TRUE if all requirements met, FALSE otherwise (invisibly)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>validate_mrct_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df.case, <span class="at">verbose =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define required variables by category</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  required <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"tte"</span>, <span class="st">"event"</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">"treat"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">continuous =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"bm"</span>),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">factor =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"histology"</span>, <span class="st">"prior_treat"</span>, <span class="st">"regA"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  all_required <span class="ot">&lt;-</span> <span class="fu">unlist</span>(required)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for missing variables</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  present <span class="ot">&lt;-</span> <span class="fu">names</span>(df.case)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  missing <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(all_required, present)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  found <span class="ot">&lt;-</span> <span class="fu">intersect</span>(all_required, present)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  issues <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check presence of variables</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    issues<span class="sc">$</span>missing <span class="ot">&lt;-</span> missing</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check variable types and values for found variables</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  type_issues <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  value_issues <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"tte"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(df.case<span class="sc">$</span>tte)) {</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      type_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(type_issues, <span class="st">"tte should be numeric"</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">any</span>(df.case<span class="sc">$</span>tte <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>      value_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(value_issues, <span class="st">"tte contains negative values"</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"event"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(df.case<span class="sc">$</span>event <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA</span>))) {</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>      value_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(value_issues, <span class="st">"event should be binary (0/1)"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"treat"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(df.case<span class="sc">$</span>treat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA</span>))) {</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>      value_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(value_issues, <span class="st">"treat should be binary (0/1)"</span>)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"age"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(df.case<span class="sc">$</span>age)) {</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>      type_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(type_issues, <span class="st">"age should be numeric"</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"bm"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(df.case<span class="sc">$</span>bm)) {</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>      type_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(type_issues, <span class="st">"bm (biomarker) should be numeric"</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"male"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(df.case<span class="sc">$</span>male <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA</span>))) {</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>      value_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(value_issues, <span class="st">"male should be binary (0/1)"</span>)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"regA"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(df.case<span class="sc">$</span>regA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA</span>))) {</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>      value_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(value_issues, <span class="st">"regA should be binary (0/1)"</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(type_issues) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    issues<span class="sc">$</span>type_issues <span class="ot">&lt;-</span> type_issues</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(value_issues) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    is_valid <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    issues<span class="sc">$</span>value_issues <span class="ot">&lt;-</span> value_issues</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Report results</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -------------------------------------------------------------------------</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"=== MRCT Data Validation ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Dataset:"</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(df.case)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Dimensions:"</span>, <span class="fu">nrow</span>(df.case), <span class="st">"rows x"</span>, <span class="fu">ncol</span>(df.case), <span class="st">"columns</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report by category</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (cat_name <span class="cf">in</span> <span class="fu">names</span>(required)) {</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>      cat_vars <span class="ot">&lt;-</span> required[[cat_name]]</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>      cat_found <span class="ot">&lt;-</span> <span class="fu">intersect</span>(cat_vars, found)</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>      cat_missing <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(cat_vars, found)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-12s: "</span>, tools<span class="sc">::</span><span class="fu">toTitleCase</span>(cat_name)))</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(cat_missing) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"✓ All present ("</span>, <span class="fu">paste</span>(cat_found, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"✗ Missing: "</span>, <span class="fu">paste</span>(cat_missing, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report issues</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(type_issues) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Type issues:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (issue <span class="cf">in</span> type_issues) {</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"  ✗"</span>, issue, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(value_issues) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Value issues:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (issue <span class="cf">in</span> value_issues) {</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"  ✗"</span>, issue, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summary</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_valid) {</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"✓ Dataset is valid for MRCT simulations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"✗ Dataset requires fixes before use</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional info</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_valid <span class="sc">&amp;&amp;</span> <span class="st">"regA"</span> <span class="sc">%in%</span> found) {</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Region distribution:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"  Region A (test):    "</span>, <span class="fu">sum</span>(df.case<span class="sc">$</span>regA <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>          <span class="st">" ("</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(df.case<span class="sc">$</span>regA <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"  Non-Region A (train):"</span>, <span class="fu">sum</span>(df.case<span class="sc">$</span>regA <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>          <span class="st">" ("</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(df.case<span class="sc">$</span>regA <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(is_valid)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="example-data-preparation" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Example Data Preparation</h1>
<section id="creating-a-synthetic-df.case-dataset" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="creating-a-synthetic-df.case-dataset"><span class="header-section-number">4.1</span> Creating a Synthetic df.case Dataset</h2>
<p>If you don’t have an existing dataset, here’s how to create a synthetic <code>df.case</code> with all required variables:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Create Synthetic MRCT Dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Generates a synthetic dataset with all required variables for MRCT simulations.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n Integer. Number of observations. Default: 1000</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param seed Integer. Random seed. Default: 12345</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param region_a_prop Numeric. Proportion in Region A. Default: 0.30</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Data frame with required MRCT variables</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>create_synthetic_mrct_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">seed =</span> <span class="dv">12345</span>, <span class="at">region_a_prop =</span> <span class="fl">0.30</span>) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  df.case <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographics</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">60</span>, <span class="at">sd =</span> <span class="dv">10</span>)),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">male =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.55</span>),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clinical factors</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">bm =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="dv">1</span>),  <span class="co"># Biomarker</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">histology =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>)),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_treat =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.35</span>),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Region indicator</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">regA =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> region_a_prop),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Treatment assignment (1:1 randomization)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Constrain values to realistic ranges</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  df.case<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">18</span>, <span class="fu">pmin</span>(<span class="dv">85</span>, df.case<span class="sc">$</span>age))</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  df.case<span class="sc">$</span>bm <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, df.case<span class="sc">$</span>bm)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate survival times with treatment effect heterogeneity</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base hazard increases with age and biomarker</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="sc">*</span> <span class="fu">exp</span>(</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span> <span class="sc">*</span> (df.case<span class="sc">$</span>age <span class="sc">-</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.05</span> <span class="sc">*</span> df.case<span class="sc">$</span>bm <span class="sc">+</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.3</span> <span class="sc">*</span> df.case<span class="sc">$</span>prior_treat</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Treatment effect: beneficial overall, but harmful for high biomarker</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HR = 0.7 overall, but HR &gt; 1 when bm &gt; 5</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  log_hr <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fl">0.15</span> <span class="sc">*</span> (df.case<span class="sc">$</span>bm <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">*</span> df.case<span class="sc">$</span>treat</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Weibull survival times</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  shape <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  scale <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (lambda <span class="sc">*</span> <span class="fu">exp</span>(log_hr))</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  t_event <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(n, <span class="at">shape =</span> shape, <span class="at">scale =</span> scale<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>shape))</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Administrative censoring at 60 months</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  t_censor <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">50</span>, <span class="dv">70</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  df.case<span class="sc">$</span>tte <span class="ot">&lt;-</span> <span class="fu">pmin</span>(t_event, t_censor)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  df.case<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(t_event <span class="sc">&lt;=</span> t_censor)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df.case)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example dataset</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>df.case <span class="ot">&lt;-</span> <span class="fu">create_synthetic_mrct_data</span>(<span class="at">n =</span> <span class="dv">2000</span>, <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate the dataset</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="fu">validate_mrct_data</span>(df.case)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MRCT Data Validation ===

Dataset: df.case 
Dimensions: 2000 rows x 9 columns

Outcome     : ✓ All present (tte, event)
Treatment   : ✓ All present (treat)
Continuous  : ✓ All present (age, bm)
Factor      : ✓ All present (male, histology, prior_treat, regA)


✓ Dataset is valid for MRCT simulations

Region distribution:
  Region A (test):    565 (28.2%)
  Non-Region A (train):1435 (71.8%)</code></pre>
</div>
</div>
</section>
<section id="preparing-an-existing-dataset" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="preparing-an-existing-dataset"><span class="header-section-number">4.2</span> Preparing an Existing Dataset</h2>
<p>If you have an existing clinical trial dataset, you may need to rename or create variables to match the expected format:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Preparing an existing dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 'clinical_data' is your existing dataset</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df.case <span class="ot">&lt;-</span> clinical_data</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename variables if needed</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"time_to_event"</span>] <span class="ot">&lt;-</span> <span class="st">"tte"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"status"</span>] <span class="ot">&lt;-</span> <span class="st">"event"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"treatment"</span>] <span class="ot">&lt;-</span> <span class="st">"treat"</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"biomarker"</span>] <span class="ot">&lt;-</span> <span class="st">"bm"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"sex"</span>] <span class="ot">&lt;-</span> <span class="st">"male"</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create region indicator if needed</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Asia-Pacific vs Rest of World</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>df.case<span class="sc">$</span>regA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(df.case<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"Asia-Pacific"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure binary coding</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>df.case<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(df.case<span class="sc">$</span>event <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>df.case<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(df.case<span class="sc">$</span>treat <span class="sc">==</span> <span class="st">"Treatment"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">validate_mrct_data</span>(df.case)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="examining-the-dataset" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="examining-the-dataset"><span class="header-section-number">4.3</span> Examining the Dataset</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic summary</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dataset dimensions:"</span>, <span class="fu">nrow</span>(df.case), <span class="st">"x"</span>, <span class="fu">ncol</span>(df.case), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset dimensions: 2000 x 9 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df.case[, <span class="fu">c</span>(<span class="st">"tte"</span>, <span class="st">"event"</span>, <span class="st">"treat"</span>, <span class="st">"age"</span>, <span class="st">"bm"</span>, <span class="st">"regA"</span>)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      tte               event           treat             age       
 Min.   : 0.05163   Min.   :0.000   Min.   :0.0000   Min.   :26.00  
 1st Qu.:16.39965   1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:53.00  
 Median :34.39633   Median :1.000   Median :1.0000   Median :60.00  
 Mean   :35.01272   Mean   :0.718   Mean   :0.5135   Mean   :59.82  
 3rd Qu.:54.15348   3rd Qu.:1.000   3rd Qu.:1.0000   3rd Qu.:67.00  
 Max.   :69.97004   Max.   :1.000   Max.   :1.0000   Max.   :85.00  
       bm              regA       
 Min.   : 0.000   Min.   :0.0000  
 1st Qu.: 2.900   1st Qu.:0.0000  
 Median : 4.900   Median :0.0000  
 Mean   : 5.009   Mean   :0.2825  
 3rd Qu.: 7.000   3rd Qu.:1.0000  
 Max.   :14.500   Max.   :1.0000  </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary table using gt</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.case <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  (\(dt) <span class="fu">data.frame</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Events"</span>, <span class="st">"Median follow-up"</span>, <span class="st">"Treatment (%)"</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Region A (%)"</span>, <span class="st">"Mean age"</span>, <span class="st">"Mean biomarker"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nrow</span>(dt),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(dt<span class="sc">$</span>event),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">median</span>(dt<span class="sc">$</span>tte), <span class="dv">1</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(dt<span class="sc">$</span>treat), <span class="dv">1</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(dt<span class="sc">$</span>regA), <span class="dv">1</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>age), <span class="dv">1</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>bm), <span class="dv">2</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  ))() <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Dataset Overview"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summary of df.case"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="peigflyhet" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#peigflyhet table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#peigflyhet thead, #peigflyhet tbody, #peigflyhet tfoot, #peigflyhet tr, #peigflyhet td, #peigflyhet th {
  border-style: none;
}

#peigflyhet p {
  margin: 0;
  padding: 0;
}

#peigflyhet .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#peigflyhet .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#peigflyhet .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#peigflyhet .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#peigflyhet .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#peigflyhet .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#peigflyhet .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#peigflyhet .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#peigflyhet .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#peigflyhet .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#peigflyhet .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#peigflyhet .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#peigflyhet .gt_spanner_row {
  border-bottom-style: hidden;
}

#peigflyhet .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#peigflyhet .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#peigflyhet .gt_from_md > :first-child {
  margin-top: 0;
}

#peigflyhet .gt_from_md > :last-child {
  margin-bottom: 0;
}

#peigflyhet .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#peigflyhet .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#peigflyhet .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#peigflyhet .gt_row_group_first td {
  border-top-width: 2px;
}

#peigflyhet .gt_row_group_first th {
  border-top-width: 2px;
}

#peigflyhet .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#peigflyhet .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#peigflyhet .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#peigflyhet .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#peigflyhet .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#peigflyhet .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#peigflyhet .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#peigflyhet .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#peigflyhet .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#peigflyhet .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#peigflyhet .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#peigflyhet .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#peigflyhet .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#peigflyhet .gt_left {
  text-align: left;
}

#peigflyhet .gt_center {
  text-align: center;
}

#peigflyhet .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#peigflyhet .gt_font_normal {
  font-weight: normal;
}

#peigflyhet .gt_font_bold {
  font-weight: bold;
}

#peigflyhet .gt_font_italic {
  font-style: italic;
}

#peigflyhet .gt_super {
  font-size: 65%;
}

#peigflyhet .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#peigflyhet .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#peigflyhet .gt_indent_1 {
  text-indent: 5px;
}

#peigflyhet .gt_indent_2 {
  text-indent: 10px;
}

#peigflyhet .gt_indent_3 {
  text-indent: 15px;
}

#peigflyhet .gt_indent_4 {
  text-indent: 20px;
}

#peigflyhet .gt_indent_5 {
  text-indent: 25px;
}

#peigflyhet .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#peigflyhet div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<td colspan="2" class="gt_heading gt_title gt_font_normal">Dataset Overview</td>
</tr>
<tr class="gt_heading even">
<td colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Summary of df.case</td>
</tr>
<tr class="gt_col_headings header">
<th id="Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Variable</th>
<th id="Value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">N</td>
<td class="gt_row gt_right" headers="Value">2000.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">Events</td>
<td class="gt_row gt_right" headers="Value">1436.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">Median follow-up</td>
<td class="gt_row gt_right" headers="Value">34.40</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">Treatment (%)</td>
<td class="gt_row gt_right" headers="Value">51.30</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">Region A (%)</td>
<td class="gt_row gt_right" headers="Value">28.20</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">Mean age</td>
<td class="gt_row gt_right" headers="Value">59.80</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">Mean biomarker</td>
<td class="gt_row gt_right" headers="Value">5.01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="creating-data-generating-mechanisms" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Creating Data Generating Mechanisms</h1>
<p>The <code>create_dgm_for_mrct()</code> function creates a data generating mechanism (DGM) that can be used to simulate survival data with specified treatment effect heterogeneity.</p>
<section id="alternative-hypothesis-heterogeneous-effect" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="alternative-hypothesis-heterogeneous-effect"><span class="header-section-number">5.1</span> Alternative Hypothesis (Heterogeneous Effect)</h2>
<p>Under the alternative hypothesis, treatment effect varies across biomarker levels:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DGM with heterogeneous treatment effect</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dgm_alt <span class="ot">&lt;-</span> <span class="fu">create_dgm_for_mrct</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_case =</span> df.case,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_type =</span> <span class="st">"alt"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_hrs =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span>)),  <span class="co"># HR varies: 2.0 -&gt; 1.0 -&gt; 0.5 across biomarker</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_regA =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Spline Constraint Applied ===
Target log(HR) at z_bm = 0: 0.693 
Target log(HR) at z_bm = knot ( 5 ): 0 
Target log(HR) at z_bm = zeta ( 10 ): -0.693 
k_treat multiplier: 1 

=== Model Parameters (AFT with Spline, log(T)) ===
Intercept (mu): 5.171 
Scale (tau): 0.819 
Spline variable: z_bm 
  Knot: 5 
  Zeta: 10 
Treatment effect at z_bm = 0: -0.568 
Treatment slope before knot: 0.114 
Treatment slope change after knot: 0 

Overall subgroup in super-population (all conditions met):
  Proportion: 0 

=== Hazard Ratios (super popln) ===
Overall HR: 0.97 
Causal AHR: 0.997 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ====================================================================== 
 CENSORING MODEL SELECTION:
 MULTIPLE SURVIVAL REGRESSION MODEL COMPARISONS
====================================================================== 

CONVERGENCE SUMMARY ( 3 / 4  converged):
-------------------------------------------------- 

Weibull (weibull):
  Status:  ✗ Failed 
  Issues:  NA coefficients 

LogNormal (lognormal):
  Status:  ✓ Converged 
  Iterations:  30 
  Log-likelihood:  -3446.906 
  Scale parameter:  0.0613 

Weibull0 (weibull):
  Status:  ✓ Converged 
  Iterations:  15 
  Log-likelihood:  -1877.772 
  Scale parameter:  0.0853 

LogNormal0 (lognormal):
  Status:  ✓ Converged 
  Iterations:  19 
  Log-likelihood:  -1851.289 
  Scale parameter:  0.0979 

MODEL COMPARISON TABLE:
-------------------------------------------------- 
      Model     AIC delta_AIC AIC_weight     BIC delta_BIC
 LogNormal0 3706.58      0.00          1 3717.78      0.00
   Weibull0 3759.54     52.97          0 3770.75     52.97
  LogNormal 6903.81   3197.23          0 6931.82   3214.04

MODEL RANKINGS:
-------------------------------------------------- 
By AIC:  LogNormal0 &gt; Weibull0 &gt; LogNormal 
By BIC:  LogNormal0 &gt; Weibull0 &gt; LogNormal 

EVIDENCE ASSESSMENT:
-------------------------------------------------- 
  Strength:  Very strong evidence 
  Details:  Top model has 100% of AIC weight 

FINAL RECOMMENDATION:
-------------------------------------------------- 
  Clear winner: LogNormal0 (best by both AIC and BIC)
  Evidence: Very strong evidence - Top model has 100% of AIC weight 
====================================================================== </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the DGM structure</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DGM Summary ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DGM Summary ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model type:"</span>, dgm_alt<span class="sc">$</span>model_type, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model type: alt </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Super-population size:"</span>, <span class="fu">nrow</span>(dgm_alt<span class="sc">$</span>df_super), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Super-population size: 5000 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Treatment HR (overall):"</span>, <span class="fu">round</span>(dgm_alt<span class="sc">$</span>hazard_ratios<span class="sc">$</span>overall, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Treatment HR (overall): 0.97 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dgm_alt<span class="sc">$</span>hazard_ratios<span class="sc">$</span>harm_subgroup)) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Treatment HR (harm subgroup):"</span>, <span class="fu">round</span>(dgm_alt<span class="sc">$</span>hazard_ratios<span class="sc">$</span>harm_subgroup, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Treatment HR (no-harm subgroup):"</span>, <span class="fu">round</span>(dgm_alt<span class="sc">$</span>hazard_ratios<span class="sc">$</span>no_harm_subgroup, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="null-hypothesis-uniform-effect" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="null-hypothesis-uniform-effect"><span class="header-section-number">5.2</span> Null Hypothesis (Uniform Effect)</h2>
<p>Under the null hypothesis, treatment effect is uniform across all patients:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DGM with uniform treatment effect</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dgm_null <span class="ot">&lt;-</span> <span class="fu">create_dgm_for_mrct</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_case =</span> df.case,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_type =</span> <span class="st">"null"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Spline Constraint Applied ===
Target log(HR) at z_bm = 0: -0.357 
Target log(HR) at z_bm = knot ( 5 ): -0.357 
Target log(HR) at z_bm = zeta ( 10 ): -0.357 
k_treat multiplier: 1 

=== Model Parameters (AFT with Spline, log(T)) ===
Intercept (mu): 5.171 
Scale (tau): 0.819 
Spline variable: z_bm 
  Knot: 5 
  Zeta: 10 
Treatment effect at z_bm = 0: 0.292 
Treatment slope before knot: 0 
Treatment slope change after knot: 0 

Overall subgroup in super-population (all conditions met):
  Proportion: 0 

=== Hazard Ratios (super popln) ===
Overall HR: 0.715 
Causal AHR: 0.7 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ====================================================================== 
 CENSORING MODEL SELECTION:
 MULTIPLE SURVIVAL REGRESSION MODEL COMPARISONS
====================================================================== 

CONVERGENCE SUMMARY ( 3 / 4  converged):
-------------------------------------------------- 

Weibull (weibull):
  Status:  ✗ Failed 
  Issues:  NA coefficients 

LogNormal (lognormal):
  Status:  ✓ Converged 
  Iterations:  30 
  Log-likelihood:  -3446.906 
  Scale parameter:  0.0613 

Weibull0 (weibull):
  Status:  ✓ Converged 
  Iterations:  15 
  Log-likelihood:  -1877.772 
  Scale parameter:  0.0853 

LogNormal0 (lognormal):
  Status:  ✓ Converged 
  Iterations:  19 
  Log-likelihood:  -1851.289 
  Scale parameter:  0.0979 

MODEL COMPARISON TABLE:
-------------------------------------------------- 
      Model     AIC delta_AIC AIC_weight     BIC delta_BIC
 LogNormal0 3706.58      0.00          1 3717.78      0.00
   Weibull0 3759.54     52.97          0 3770.75     52.97
  LogNormal 6903.81   3197.23          0 6931.82   3214.04

MODEL RANKINGS:
-------------------------------------------------- 
By AIC:  LogNormal0 &gt; Weibull0 &gt; LogNormal 
By BIC:  LogNormal0 &gt; Weibull0 &gt; LogNormal 

EVIDENCE ASSESSMENT:
-------------------------------------------------- 
  Strength:  Very strong evidence 
  Details:  Top model has 100% of AIC weight 

FINAL RECOMMENDATION:
-------------------------------------------------- 
  Clear winner: LogNormal0 (best by both AIC and BIC)
  Evidence: Very strong evidence - Top model has 100% of AIC weight 
====================================================================== </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Null DGM Summary ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Null DGM Summary ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Treatment HR (overall):"</span>, <span class="fu">round</span>(dgm_null<span class="sc">$</span>hazard_ratios<span class="sc">$</span>overall, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Treatment HR (overall): 0.715 </code></pre>
</div>
</div>
</section>
<section id="adding-confounder-effects" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="adding-confounder-effects"><span class="header-section-number">5.3</span> Adding Confounder Effects</h2>
<p>You can add prognostic confounder effects to the DGM:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DGM with prior treatment as prognostic confounder</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dgm_conf <span class="ot">&lt;-</span> <span class="fu">create_dgm_for_mrct</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_case =</span> df.case,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_type =</span> <span class="st">"alt"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">confounder_var =</span> <span class="st">"prior_treat"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">confounder_effect =</span> <span class="fu">log</span>(<span class="fl">1.5</span>),  <span class="co"># 50% higher hazard for prior treatment</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="running-simulations" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Running Simulations</h1>
<p>The <code>mrct_region_sims()</code> function runs parallelized simulations to evaluate ForestSearch subgroup identification performance.</p>
<section id="basic-simulation" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="basic-simulation"><span class="header-section-number">6.1</span> Basic Simulation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run simulations (small example for demonstration)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>results_alt <span class="ot">&lt;-</span> <span class="fu">mrct_region_sims</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dgm =</span> dgm_alt,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sims =</span> <span class="dv">100</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sample =</span> <span class="dv">800</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">region_var =</span> <span class="st">"z_regA"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sg_focus =</span> <span class="st">"minSG"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxk =</span> <span class="dv">1</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr.consistency =</span> <span class="fl">0.80</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pconsistency.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">confounders.name =</span> <span class="fu">c</span>(<span class="st">"z_age"</span>, <span class="st">"z_bm"</span>, <span class="st">"z_male"</span>, <span class="st">"z_histology"</span>, </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"z_prior_treat"</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_args =</span> <span class="fu">list</span>(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plan =</span> <span class="st">"multisession"</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">workers =</span> <span class="dv">4</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_message =</span> <span class="cn">TRUE</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">details =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">12345</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Simulations completed (demonstration data)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Subgroup identification rate: 68 %</code></pre>
</div>
</div>
</section>
<section id="configuring-parallel-execution" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="configuring-parallel-execution"><span class="header-section-number">6.2</span> Configuring Parallel Execution</h2>
<p>The <code>parallel_args</code> parameter controls parallel execution:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Multisession (works on all platforms)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>parallel_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plan =</span> <span class="st">"multisession"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">workers =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_message =</span> <span class="cn">TRUE</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Multicore (Unix/Mac only, more efficient)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>parallel_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plan =</span> <span class="st">"multicore"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">workers =</span> <span class="dv">8</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_message =</span> <span class="cn">TRUE</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3: Sequential (for debugging)</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>parallel_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">plan =</span> <span class="st">"sequential"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_message =</span> <span class="cn">TRUE</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 4: Callr (isolated R processes)</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>parallel_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">plan =</span> <span class="st">"callr"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">workers =</span> <span class="dv">4</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_message =</span> <span class="cn">TRUE</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="key-parameters" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="key-parameters"><span class="header-section-number">6.3</span> Key Parameters</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 32%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
<th>Typical Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>n_sims</code></td>
<td>Number of simulations</td>
<td>100-1000</td>
</tr>
<tr class="even">
<td><code>n_sample</code></td>
<td>Sample size per simulation</td>
<td>500-2000</td>
</tr>
<tr class="odd">
<td><code>region_var</code></td>
<td>Variable for train/test split</td>
<td>“z_regA”</td>
</tr>
<tr class="even">
<td><code>sg_focus</code></td>
<td>Subgroup selection criterion</td>
<td>“minSG”, “hr”, “maxSG”</td>
</tr>
<tr class="odd">
<td><code>maxk</code></td>
<td>Max factors in subgroup</td>
<td>1 or 2</td>
</tr>
<tr class="even">
<td><code>hr.threshold</code></td>
<td>HR threshold for identification</td>
<td>0.85-0.95</td>
</tr>
<tr class="odd">
<td><code>pconsistency.threshold</code></td>
<td>Consistency probability threshold</td>
<td>0.85-0.95</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="summarizing-results" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Summarizing Results</h1>
<section id="summary-tables-with-gt" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="summary-tables-with-gt"><span class="header-section-number">7.1</span> Summary Tables with gt</h2>
<p>The <code>summaryout_mrct()</code> function creates formatted summary tables:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate summary tables</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>summary_results <span class="ot">&lt;-</span> <span class="fu">summaryout_mrct</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop_summary =</span> <span class="cn">NULL</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrct_sims =</span> results_alt,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sg_type =</span> <span class="dv">1</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tab_caption =</span> <span class="st">"MRCT Simulation Results: Alternative Hypothesis"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">showtable =</span> <span class="cn">TRUE</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;div id="huygnookjs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;"&gt;
  &lt;style&gt;#huygnookjs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#huygnookjs thead, #huygnookjs tbody, #huygnookjs tfoot, #huygnookjs tr, #huygnookjs td, #huygnookjs th {
  border-style: none;
}

#huygnookjs p {
  margin: 0;
  padding: 0;
}

#huygnookjs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#huygnookjs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#huygnookjs .gt_title {
  color: #333333;
  font-size: 14px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#huygnookjs .gt_subtitle {
  color: #333333;
  font-size: 12px;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#huygnookjs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#huygnookjs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#huygnookjs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#huygnookjs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#huygnookjs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#huygnookjs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#huygnookjs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#huygnookjs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#huygnookjs .gt_spanner_row {
  border-bottom-style: hidden;
}

#huygnookjs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#huygnookjs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#huygnookjs .gt_from_md &gt; :first-child {
  margin-top: 0;
}

#huygnookjs .gt_from_md &gt; :last-child {
  margin-bottom: 0;
}

#huygnookjs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#huygnookjs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#huygnookjs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#huygnookjs .gt_row_group_first td {
  border-top-width: 2px;
}

#huygnookjs .gt_row_group_first th {
  border-top-width: 2px;
}

#huygnookjs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#huygnookjs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#huygnookjs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#huygnookjs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#huygnookjs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#huygnookjs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#huygnookjs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#huygnookjs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#huygnookjs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#huygnookjs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#huygnookjs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#huygnookjs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#huygnookjs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#huygnookjs .gt_left {
  text-align: left;
}

#huygnookjs .gt_center {
  text-align: center;
}

#huygnookjs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#huygnookjs .gt_font_normal {
  font-weight: normal;
}

#huygnookjs .gt_font_bold {
  font-weight: bold;
}

#huygnookjs .gt_font_italic {
  font-style: italic;
}

#huygnookjs .gt_super {
  font-size: 65%;
}

#huygnookjs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#huygnookjs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#huygnookjs .gt_indent_1 {
  text-indent: 5px;
}

#huygnookjs .gt_indent_2 {
  text-indent: 10px;
}

#huygnookjs .gt_indent_3 {
  text-indent: 15px;
}

#huygnookjs .gt_indent_4 {
  text-indent: 20px;
}

#huygnookjs .gt_indent_5 {
  text-indent: 25px;
}

#huygnookjs .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#huygnookjs div.Reactable &gt; div.rt-table &gt; div.rt-thead &gt; div.rt-tr.rt-tr-group-header &gt; div.rt-th-group:after {
  height: 0px !important;
}
&lt;/style&gt;
  &lt;table class="gt_table" style="table-layout:fixed;width:0px;" data-quarto-disable-processing="false" data-quarto-bootstrap="false"&gt;
  &lt;colgroup&gt;
    &lt;col style="width:180px;"/&gt;
    &lt;col style="width:250px;"/&gt;
    &lt;col style="width:180px;"/&gt;
  &lt;/colgroup&gt;
  &lt;thead&gt;
    &lt;tr class="gt_heading"&gt;
      &lt;td colspan="3" class="gt_heading gt_title gt_font_normal" style&gt;MRCT Simulation Results: Alternative Hypothesis&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr class="gt_heading"&gt;
      &lt;td colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style&gt;Based on 100 simulations&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr class="gt_col_headings"&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Category"&gt;Category&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metric"&gt;Metric&lt;/th&gt;
      &lt;th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Value"&gt;Mean (SD) / N (%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody class="gt_table_body"&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="font-weight: bold; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR Estimates&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR ITT&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.723 (0.083)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR ITT (stratified by region)&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.722 (0.081)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR Training (non-Region A)&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.699 (0.102)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR Testing (Region A)&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.784 (0.105)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;HR Subgroup&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.642 (0.150)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;PO HR Subgroup&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.577 (0.104)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="font-weight: bold; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Subgroup Identification&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Subgroup Found&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;68.0%&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Prevalence (when found)&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;0.428 (0.094)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="font-weight: bold; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Region A Classification&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;RegA HR &amp;gt; 0.9&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;15 (15.0%)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;RegA(sg) HR &amp;lt;= 0.85&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;95 (95.0%)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;RegA &amp;gt; 0.9 &amp;amp; RegA(sg) &amp;lt;= 0.85&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;15 (15.0%)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;RegA &amp;gt; 0.9 &amp;amp; RegA(sg) &amp;lt;= 0.80&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;13 (13.0%)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="font-weight: bold; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Subgroup Classification&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Biomarker&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;36 (36.0%)&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td headers="Category" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;&lt;/td&gt;
&lt;td headers="Metric" class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;Age&lt;/td&gt;
&lt;td headers="Value" class="gt_row gt_right" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #D3D3D3;"&gt;12 (12.0%)&lt;/td&gt;&lt;/tr&gt;
  &lt;/tbody&gt;
  
&lt;/table&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</section>
<section id="accessing-summary-components" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="accessing-summary-components"><span class="header-section-number">7.2</span> Accessing Summary Components</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access processed data with derived variables</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Derived variables added:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Derived variables added:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>new_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(summary_results<span class="sc">$</span>data), <span class="fu">names</span>(results_alt))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_vars)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "regAflag"       "sg_le85"        "regAflag2"      "regAflag3"     
 [5] "found"          "sg_biomarker"   "sg_age"         "sg_male"       
 [9] "sg_ecog"        "sg_histology"   "sg_CTregimen"   "sg_region"     
[13] "sg_surgery"     "sg_prior_treat"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check classification results</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Region A classification:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Region A classification:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(summary_results<span class="sc">$</span>data<span class="sc">$</span>regAflag))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
RegA &lt;= 0.9  RegA &gt; 0.9 
         85          15 </code></pre>
</div>
</div>
</section>
</section>
<section id="visualizing-results" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Visualizing Results</h1>
<section id="hazard-ratio-distributions" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="hazard-ratio-distributions"><span class="header-section-number">8.1</span> Hazard Ratio Distributions</h2>
<p>The <code>SGplot_estimates()</code> function creates violin/boxplots of HR distributions:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create HR distribution plot</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plot_results <span class="ot">&lt;-</span> <span class="fu">SGplot_estimates</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> results_alt,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_training =</span> <span class="st">"Training (Non-Region A)"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_testing =</span> <span class="st">"Testing (Region A)"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_itt =</span> <span class="st">"ITT (Stratified)"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_sg =</span> <span class="st">"Subgroup (when found)"</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_results<span class="sc">$</span>plot_estimates)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mrct_simulation_vignette_files/figure-html/plot-estimates-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="custom-visualizations" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="custom-visualizations"><span class="header-section-number">8.2</span> Custom Visualizations</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subgroup identification by simulation</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(results_alt, <span class="fu">aes</span>(<span class="at">x =</span> sim, <span class="at">y =</span> hr_test, <span class="at">color =</span> <span class="fu">factor</span>(any_found))) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"gray50"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"No subgroup found"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Subgroup found"</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Identification"</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Simulation"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Region A Hazard Ratio"</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Subgroup Identification Across Simulations"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Dashed line: HR=1; Dotted line: HR=0.9 threshold"</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mrct_simulation_vignette_files/figure-html/custom-plots-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of identified subgroups</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>results_alt[any_found <span class="sc">==</span> <span class="dv">1</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sg_found, <span class="at">fill =</span> sg_found)) <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Identified Subgroup"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Identified Subgroups"</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Total found: %d / %d simulations"</span>, </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sum</span>(results_alt<span class="sc">$</span>any_found), <span class="fu">nrow</span>(results_alt))</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mrct_simulation_vignette_files/figure-html/biomarker-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="complete-workflow-example" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Complete Workflow Example</h1>
<p>Here’s a complete workflow from data preparation to results:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Prepare and validate data</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>df.case <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"path/to/your/data.csv"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure required variable names and coding</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"time"</span>] <span class="ot">&lt;-</span> <span class="st">"tte"</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.case)[<span class="fu">names</span>(df.case) <span class="sc">==</span> <span class="st">"status"</span>] <span class="ot">&lt;-</span> <span class="st">"event"</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>df.case<span class="sc">$</span>regA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(df.case<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"Asia"</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">validate_mrct_data</span>(df.case))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create DGMs for both hypotheses</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>dgm_alt <span class="ot">&lt;-</span> <span class="fu">create_dgm_for_mrct</span>(</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_case =</span> df.case,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_type =</span> <span class="st">"alt"</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_hrs =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span>)),  <span class="co"># Strong HTE</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>dgm_null <span class="ot">&lt;-</span> <span class="fu">create_dgm_for_mrct</span>(</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_case =</span> df.case,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_type =</span> <span class="st">"null"</span>,</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Run simulations under alternative hypothesis</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>results_alt <span class="ot">&lt;-</span> <span class="fu">mrct_region_sims</span>(</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">dgm =</span> dgm_alt,</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sims =</span> <span class="dv">500</span>,</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sample =</span> <span class="dv">1000</span>,</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">region_var =</span> <span class="st">"z_regA"</span>,</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">sg_focus =</span> <span class="st">"minSG"</span>,</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxk =</span> <span class="dv">1</span>,</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">pconsistency.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_args =</span> <span class="fu">list</span>(<span class="at">plan =</span> <span class="st">"multisession"</span>, <span class="at">workers =</span> <span class="dv">8</span>),</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2024</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Run simulations under null hypothesis (Type I error)</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>results_null <span class="ot">&lt;-</span> <span class="fu">mrct_region_sims</span>(</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">dgm =</span> dgm_null,</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sims =</span> <span class="dv">500</span>,</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sample =</span> <span class="dv">1000</span>,</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">region_var =</span> <span class="st">"z_regA"</span>,</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">sg_focus =</span> <span class="st">"minSG"</span>,</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxk =</span> <span class="dv">1</span>,</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">pconsistency.threshold =</span> <span class="fl">0.90</span>,</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_args =</span> <span class="fu">list</span>(<span class="at">plan =</span> <span class="st">"multisession"</span>, <span class="at">workers =</span> <span class="dv">8</span>),</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2024</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Summarize and compare results</span></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== Alternative Hypothesis Results ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>summary_alt <span class="ot">&lt;-</span> <span class="fu">summaryout_mrct</span>(<span class="at">mrct_sims =</span> results_alt, </span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a>                                <span class="at">tab_caption =</span> <span class="st">"Alternative Hypothesis"</span>)</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Null Hypothesis Results (Type I Error) ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>summary_null <span class="ot">&lt;-</span> <span class="fu">summaryout_mrct</span>(<span class="at">mrct_sims =</span> results_null,</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">tab_caption =</span> <span class="st">"Null Hypothesis"</span>)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Key metrics</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Summary ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Power (H1):"</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(results_alt<span class="sc">$</span>any_found), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Type I Error (H0):"</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(results_null<span class="sc">$</span>any_found), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Visualize results</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>plot_alt <span class="ot">&lt;-</span> <span class="fu">SGplot_estimates</span>(results_alt)</span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_alt<span class="sc">$</span>plot_estimates)</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results</span></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(results_alt, <span class="st">"results_alternative.rds"</span>)</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(results_null, <span class="st">"results_null.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="session-info" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Session Info</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Tahoe 26.2

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] gt_1.3.0                ggplot2_4.0.1           survival_3.8-6         
[4] data.table_1.18.0       forestsearch_0.0.0.9000

loaded via a namespace (and not attached):
 [1] sass_0.4.10          future_1.69.0        generics_0.1.4      
 [4] xml2_1.4.0           shape_1.4.6.1        stringi_1.8.7       
 [7] lattice_0.22-7       listenv_0.9.1        digest_0.6.37       
[10] magrittr_2.0.4       grf_2.5.0            evaluate_1.0.5      
[13] grid_4.5.1           RColorBrewer_1.1-3   iterators_1.0.14    
[16] policytree_1.2.3     fastmap_1.2.0        foreach_1.5.2       
[19] jsonlite_2.0.0       Matrix_1.7-3         glmnet_4.1-10       
[22] scales_1.4.0         weightedsurv_0.1.0   codetools_0.2-20    
[25] cli_3.6.5            rlang_1.1.6          parallelly_1.46.1   
[28] future.apply_1.20.1  splines_4.5.1        withr_3.0.2         
[31] yaml_2.3.10          tools_4.5.1          parallel_4.5.1      
[34] doFuture_1.2.0       dplyr_1.1.4          globals_0.18.0      
[37] vctrs_0.6.5          R6_2.6.1             lifecycle_1.0.4     
[40] stringr_1.6.0        randomForest_4.7-1.2 fs_1.6.6            
[43] htmlwidgets_1.6.4    pkgconfig_2.0.3      progressr_0.18.0    
[46] pillar_1.11.1        gtable_0.3.6         glue_1.8.0          
[49] Rcpp_1.1.0           xfun_0.53            tibble_3.3.0        
[52] tidyselect_1.2.1     rstudioapi_0.17.1    knitr_1.51          
[55] farver_2.1.2         htmltools_0.5.8.1    labeling_0.4.3      
[58] rmarkdown_2.30       compiler_4.5.1       S7_0.2.0            </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>