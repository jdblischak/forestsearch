\documentclass[8pt]{article}\usepackage[]{graphicx}\usepackage[]{xcolor}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{multicol}
\usepackage{amssymb,mathrsfs,graphicx}
\usepackage{enumerate}
\usepackage{amsthm}
\usepackage{lscape}
\usepackage{pdfpages}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\theoremstyle{remark}
\newtheorem{remark}{Remark}

\usepackage[colorlinks=true,linkcolor={blue},citecolor={blue},urlcolor={blue}]{hyperref}
\usepackage{longtable,ctable}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{mathptmx}
\usepackage{natbib}
\usepackage{setspace}

\usepackage[utf8]{inputenc}
\usepackage{pgf}

\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{enumerate}
\usepackage{threeparttable}


\newcommand{\R}{R}
\newcommand{\gbsg}{gbsg}

\def\FsNg{\hbox{FS}(M_{g})}

\def\hhat{\hat\theta(\hat{H})}
\def\hchat{\hat\theta(\hat{H}^{c})}
\def\hknow{\hat\theta(H)}
\def\hcknow{\hat\theta(H^{c})}
\def\hplim{\theta^{\dagger}(H)}
\def\hcplim{\theta^{\dagger}(H^{c})}


\newcommand{\indep}{\perp \!\!\! \perp}

\textheight=9.25in \textwidth=6.0in 
\topmargin=0in
\evensidemargin=0in \oddsidemargin=0in
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

\raggedbottom





\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{N} \hlkwb{<-} \hlnum{700}
\hlstd{Nsims} \hlkwb{<-} \hlnum{20}\hlopt{*}\hlnum{1000}

\hlstd{maxFollow}\hlkwb{<-}\hlnum{84}
\hlstd{cens.type}\hlkwb{<-}\hlstr{"weibull"}
\hlcom{#########################}
\hlcom{# Forest search criteria}
\hlcom{#########################}
\hlstd{hr.threshold}\hlkwb{<-}\hlnum{1.25}   \hlcom{# Initital candidates }
\hlstd{hr.consistency}\hlkwb{<-}\hlnum{1.0}  \hlcom{# Candidates for many splits}

\hlstd{pconsistency.threshold} \hlkwb{<-} \hlnum{0.9}
\hlstd{stop.threshold} \hlkwb{<-} \hlnum{0.95}

\hlstd{maxk}\hlkwb{<-}\hlnum{2}
\hlstd{nmin.fs}\hlkwb{<-}\hlnum{60}
\hlstd{pstop_futile}\hlkwb{<-}\hlnum{0.7}

\hlcom{# Limit timing for forestsearch}
\hlstd{max.minutes}\hlkwb{<-}\hlnum{3.0}
\hlstd{m1.threshold}\hlkwb{<-}\hlnum{Inf} \hlcom{# Turning this off (Default)}
\hlcom{#pconsistency.threshold<-0.70 # Minimum threshold (will choose max among subgroups satisfying)}
\hlstd{fs.splits}\hlkwb{<-}\hlnum{400} \hlcom{# How many times to split for consistency}
\hlcom{# vi is % factor is selected in cross-validation --> higher more important}
\hlstd{vi.grf.min} \hlkwb{<-} \hlstd{(}\hlopt{-}\hlnum{1}\hlstd{)}\hlopt{*}\hlnum{0.2} \hlcom{# This is default (to NOT exclude via VI)}
\hlcom{# Null, turns off grf screening}
\hlstd{d.min}\hlkwb{<-}\hlnum{10} \hlcom{# Min number of events for both arms (d0.min=d1.min=d.min)}
\hlcom{# default=5}

\hlcom{##########################}
\hlcom{# Virtual twins analysis}
\hlcom{##########################}
\hlcom{# Counter-factual difference (C-E) >= vt.threshold}
\hlcom{# Large values in favor of C (control)}
\hlstd{vt.threshold}\hlkwb{<-}\hlnum{0.225}  \hlcom{# For VT delta}
\hlstd{treat.threshold}\hlkwb{<-}\hlnum{0.0}

\hlstd{maxdepth} \hlkwb{<-} \hlnum{2}
\hlstd{n.min}\hlkwb{<-}\hlnum{60}
\hlstd{ntree}\hlkwb{<-}\hlnum{1000}

\hlcom{# GRF criteria}
\hlstd{dmin.grf}\hlkwb{<-}\hlnum{12.0} \hlcom{# For GRF delta}
\hlcom{# Note: For CRT this represents dmin.grf/2 RMS for control (-dmin.grf/2 for treatment)}
\hlstd{frac.tau} \hlkwb{<-} \hlnum{0.60}

\hlcom{# For forestsearch algorithm use same as GRF}
\hlstd{frac.tau_fs} \hlkwb{<-} \hlnum{0.60}
\hlstd{dmin.grf_fs} \hlkwb{<-} \hlnum{12}
\hlstd{maxdepth_fs} \hlkwb{<-} \hlnum{2}

\hlstd{label.analyses}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"FSl"}\hlstd{,}\hlstr{"GRF"}\hlstd{,}\hlstr{"VT(24)"}\hlstd{,}\hlstr{"VT#(24)"}\hlstd{,}\hlstr{"VT(36)"}\hlstd{,}\hlstr{"VT#(36)"}\hlstd{,}\hlstr{"GRF.60"}\hlstd{)}
\hlcom{# Classification table names}
\hlstd{est_names}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"$FS_\{g\}$"}\hlstd{,}\hlstr{"$FS_\{lg\}$"}\hlstd{,}\hlstr{"$GRF$"}\hlstd{,}\hlstr{"$GRF_\{60\}$"}\hlstd{,}\hlstr{"$VT(24)$"}\hlstd{,}\hlstr{"$\{VT\}^\{\textbackslash{}\textbackslash{}#\}(24)$"}\hlstd{,}\hlstr{"$VT(36)$"}\hlstd{,}\hlstr{"$\{VT\}^\{\textbackslash{}\textbackslash{}#\}(36)$"}\hlstd{)}

\hlstd{outcome.name}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"y.sim"}\hlstd{)}
\hlstd{event.name}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"event.sim"}\hlstd{)}
\hlstd{id.name}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"id"}\hlstd{)}
\hlstd{treat.name}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"treat"}\hlstd{)}

\hlstd{cox.formula.sim}\hlkwb{<-}\hlkwd{as.formula}\hlstd{(}\hlkwd{paste}\hlstd{(}\hlstr{"Surv(y.sim,event.sim)~treat"}\hlstd{))}
\hlstd{cox.formula.adj.sim}\hlkwb{<-}\hlkwd{as.formula}\hlstd{(}\hlkwd{paste}\hlstd{(}\hlstr{"Surv(y.sim,event.sim)~treat+v1+v2+v3+v4+v5"}\hlstd{))}

\hlstd{get.FS}\hlkwb{<-}\hlnum{TRUE}
\hlstd{get.VT}\hlkwb{<-}\hlnum{TRUE}
\hlstd{get.GRF}\hlkwb{<-}\hlnum{TRUE}

\hlstd{fl_prefix} \hlkwb{<-} \hlkwd{paste0}\hlstd{(}\hlstr{"oc_sims="}\hlstd{,Nsims,}\hlstr{"_"}\hlstd{)}

\hlstd{out.loc}\hlkwb{<-}\hlkwd{paste0}\hlstd{(}\hlstr{"results/"}\hlstd{,fl_prefix)}

\hlcom{# m1 -censoring adjustment}
\hlstd{muC.adj}\hlkwb{<-}\hlkwd{log}\hlstd{(}\hlnum{1.5}\hlstd{)}

\hlcom{# 0, 3, or 5}
\hlstd{n_add_noise} \hlkwb{<-} \hlnum{0.0}

\hlstd{mindex} \hlkwb{<-} \hlstr{"m4a"}
\hlstd{file.index}\hlkwb{<-}\hlstr{"v0-4cuts"}

\hlstd{z1_frac} \hlkwb{<-} \hlnum{0.25}

\hlkwa{if}\hlstd{(mindex}\hlopt{==}\hlstr{"m4a"}\hlstd{)\{}
\hlstd{k.z3} \hlkwb{<-} \hlnum{1.0}
\hlstd{k.treat} \hlkwb{<-} \hlnum{0.9}
\hlstd{pH_super} \hlkwb{<-} \hlnum{0.125} \hlcom{# non-NULL re-defines z1_frac}
\hlstd{\}}

\hlkwa{if}\hlstd{(mindex}\hlopt{==}\hlstr{"m4aB"}\hlstd{)\{}
\hlstd{k.z3} \hlkwb{<-} \hlnum{1.0}
\hlstd{k.treat} \hlkwb{<-} \hlnum{0.9}
\hlstd{pH_super} \hlkwb{<-} \hlnum{0.20} \hlcom{# non-NULL re-defines z1_frac}
\hlstd{\}}

\hlkwa{if}\hlstd{(mindex}\hlopt{==}\hlstr{"m4b"}\hlstd{)\{}
\hlstd{k.z3} \hlkwb{<-} \hlnum{1.0}
\hlstd{k.treat} \hlkwb{<-} \hlnum{1.25}
\hlstd{pH_super} \hlkwb{<-} \hlnum{0.30} \hlcom{# non-NULL re-defines z1_frac}
\hlstd{\}}

\hlkwa{if}\hlstd{(mindex}\hlopt{==}\hlstr{"m4c"}\hlstd{)\{}
\hlstd{k.z3} \hlkwb{<-} \hlnum{1.0}
\hlstd{k.treat} \hlkwb{<-} \hlnum{1.5}
\hlstd{pH_super} \hlkwb{<-} \hlnum{0.30} \hlcom{# non-NULL re-defines z1_frac}
\hlstd{\}}

\hlstd{model.index} \hlkwb{<-} \hlkwd{paste0}\hlstd{(mindex,}\hlstr{"-Noise="}\hlstd{,}\hlstr{""}\hlstd{)}
\hlstd{model.index} \hlkwb{<-} \hlkwd{paste0}\hlstd{(model.index,n_add_noise,}\hlstr{""}\hlstd{)}

\hlkwa{if}\hlstd{(}\hlkwd{is.null}\hlstd{(pH_super))\{}
\hlcom{#pH_check<-with(gbsg,mean(pgr<=quantile(pgr,c(z3_frac),1,0) & er<=quantile(er,z1_frac)))}
\hlstd{pH_check}\hlkwb{<-}\hlkwd{with}\hlstd{(gbsg,}\hlkwd{mean}\hlstd{(meno}\hlopt{==}\hlnum{0} \hlopt{&} \hlstd{er}\hlopt{<=}\hlkwd{quantile}\hlstd{(er,z1_frac)))}
\hlkwd{cat}\hlstd{(}\hlstr{"Underlying pH_super"}\hlstd{,}\hlkwd{c}\hlstd{(pH_check),}\hlstr{"\textbackslash{}n"}\hlstd{)}
\hlstd{\}}
\hlcom{# pH_super specified}
\hlcom{# If pH_super then override  z1_frac and find z1_frac to yield pH_super}

\hlkwa{if}\hlstd{(}\hlopt{!}\hlkwd{is.null}\hlstd{(pH_super))\{}
  \hlcom{# Approximate Z1 quantile to yield pH proportion  }
  \hlstd{z1_q}\hlkwb{<-}\hlkwd{uniroot}\hlstd{(propH.obj4,}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,}\hlnum{1}\hlstd{),}\hlkwc{tol}\hlstd{=}\hlnum{0.0001}\hlstd{,}\hlkwc{pH.target}\hlstd{=pH_super)}\hlopt{$}\hlstd{root}
  \hlcom{#pH_check<-with(gbsg,mean(pgr<=quantile(pgr,c(z3_frac),1,0) & er<=quantile(er,z1_q)))}
  \hlstd{pH_check}\hlkwb{<-}\hlkwd{with}\hlstd{(gbsg,}\hlkwd{mean}\hlstd{(meno}\hlopt{==}\hlnum{0} \hlopt{&} \hlstd{er}\hlopt{<=}\hlkwd{quantile}\hlstd{(er,z1_q)))}
  \hlkwd{cat}\hlstd{(}\hlstr{"pH"}\hlstd{,}\hlkwd{c}\hlstd{(pH_check),}\hlstr{"\textbackslash{}n"}\hlstd{)}
  \hlstd{rel_error}\hlkwb{<-}\hlstd{(pH_super}\hlopt{-}\hlstd{pH_check)}\hlopt{/}\hlstd{pH_super}
  \hlkwa{if}\hlstd{(}\hlkwd{abs}\hlstd{(rel_error)}\hlopt{>=}\hlnum{0.1}\hlstd{)} \hlkwd{stop}\hlstd{(}\hlstr{"pH_super approximation relative error exceeds 10%"}\hlstd{)}
  \hlstd{z1_frac}\hlkwb{<-}\hlstd{z1_q}
  \hlkwd{cat}\hlstd{(}\hlstr{"Underlying pH_super"}\hlstd{,}\hlkwd{c}\hlstd{(pH_check),}\hlstr{"\textbackslash{}n"}\hlstd{)}
  \hlstd{\}}
\end{alltt}
\begin{verbatim}
## pH 0.122449 
## Underlying pH_super 0.122449
\end{verbatim}
\begin{alltt}
\hlcom{# Bootstrap on log(hr) scale converted to HR (est.loghr=TRUE & est.scale="hr")}
\hlstd{est.loghr}\hlkwb{<-}\hlnum{TRUE}
\hlstd{est.scale}\hlkwb{<-}\hlstr{"hr"}
\hlstd{t.start.all}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}

\hlcom{# Classification table names}
\hlcom{# Note: within tab_tests (summary.VTFS)}
\hlcom{# we rename so that denominator in ppv(hatH) is # hatH}
\hlcom{# Manuscript section 3.2 will be updated accordingly}

\hlstd{stat_names}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlstr{"any(H)"}\hlstd{,}\hlstr{"$\{sens\}(\textbackslash{}\textbackslash{}hat\{H\})$"}\hlstd{,}\hlstr{"$\{sens\}(\textbackslash{}\textbackslash{}hat\{H\}^\{C\})$"}\hlstd{,}
                        \hlstr{"$\{ppv\}(\textbackslash{}\textbackslash{}hat\{H\})$"}\hlstd{,}\hlstr{"$\{ppv\}(\textbackslash{}\textbackslash{}hat\{H\}^\{C\})$"}\hlstd{,}
                        \hlstr{"$\{avg\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\} \textbackslash{}\textbackslash{}vert$"}\hlstd{,}
                        \hlstr{"$\{min\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\} \textbackslash{}\textbackslash{}vert$"}\hlstd{,}
                        \hlstr{"$\{max\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\} \textbackslash{}\textbackslash{}vert$"}\hlstd{,}
                        \hlstr{"$\{avg\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\}^\{C\} \textbackslash{}\textbackslash{}vert$"}\hlstd{,}
                        \hlstr{"$\{min\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\}^\{C\} \textbackslash{}\textbackslash{}vert$"}\hlstd{,}
                        \hlstr{"$\{max\}\textbackslash{}\textbackslash{}vert \textbackslash{}\textbackslash{}hat\{H\}^\{C\} \textbackslash{}\textbackslash{}vert$"}\hlstd{)}

\hlkwa{if}\hlstd{(}\hlopt{!}\hlstd{get.FS) est_names}\hlkwb{<-}\hlstd{est_names[}\hlopt{-}\hlkwd{c}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{)]}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mod.harm} \hlkwb{<-} \hlstr{"null"}
\hlstd{this.dgm}\hlkwb{<-}\hlkwd{get.dgm4.OC}\hlstd{(}\hlkwc{mod.harm}\hlstd{=mod.harm,}\hlkwc{N}\hlstd{=N,}\hlkwc{k.treat}\hlstd{=k.treat,}\hlkwc{model.index}\hlstd{=model.index,}\hlkwc{sol_tol}\hlstd{=}\hlnum{10}\hlopt{^-}\hlnum{8}\hlstd{,}
\hlkwc{hrH.target}\hlstd{=hrH.target,}\hlkwc{cens.type}\hlstd{=cens.type,}\hlkwc{out.loc}\hlstd{=out.loc,}\hlkwc{file.index}\hlstd{=file.index,}\hlkwc{details}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{parms_torand}\hlstd{=}\hlnum{FALSE}\hlstd{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{figure/r_null-1} 
\begin{kframe}\begin{verbatim}
## Super-population empirical harm and non-harm hazard ratios= NA 0.701027 
## Causal HR (empirical ITT)= 0.701027
\end{verbatim}
\begin{alltt}
\hlstd{dgm}\hlkwb{<-}\hlstd{this.dgm}\hlopt{$}\hlstd{dgm}
\hlstd{output.file}\hlkwb{<-}\hlstd{this.dgm}\hlopt{$}\hlstd{out.file}

\hlkwa{if}\hlstd{(}\hlopt{!}\hlkwd{is.null}\hlstd{(output.file)} \hlopt{& !}\hlkwd{grepl}\hlstd{(mod.harm,output.file))} \hlkwd{stop}\hlstd{(}\hlstr{"Wrong file name for mod.harm"}\hlstd{)}

\hlcom{# Show first simulation}
\hlcom{#ans1 <- oc_analyses_m4_FS4(1)}

\hlstd{t.start}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}
\hlstd{res} \hlkwb{<-} \hlkwd{foreach}\hlstd{(}
    \hlkwc{sim} \hlstd{=} \hlkwd{seq_len}\hlstd{(Nsims),}
    \hlkwc{.options.future}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{seed}\hlstd{=}\hlnum{TRUE}\hlstd{),}
    \hlkwc{.combine}\hlstd{=}\hlstr{"rbind"}\hlstd{,}
    \hlkwc{.errorhandling}\hlstd{=}\hlstr{"pass"}
  \hlstd{)} \hlopt{%dofuture%} \hlstd{\{}
\hlstd{ans} \hlkwb{<-} \hlkwd{oc_analyses_m4FourCuts_FS4}\hlstd{(sim)}
\hlkwd{return}\hlstd{(ans)}
\hlstd{\}}
\end{alltt}
\begin{verbatim}
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.01796 2 
##    leaf.node control.mean control.size control.se depth
## 1          2         1.58        77.00       2.99     1
## 2          3        -4.47       623.00       1.15     1
## 11         4        -5.22       179.00       2.04     2
## 21         5         1.69       171.00       1.89     2
## 4          7        -6.87       324.00       1.69     2
##    leaf.node control.mean control.size control.se depth
## 21         5         1.69       171.00       1.89     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.4" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q6 q8 q4 q9 q7 q10 q5 q3 q1 q2 
##         Factors Labels VI(grf)
## 6            z2     q6  0.1982
## 8            z4     q8  0.1410
## 4    size <= 35     q4  0.1131
## 9            z5     q9  0.0978
## 7            z3     q7  0.0954
## 10       grade3    q10  0.0824
## 5            z1     q5  0.0805
## 3    size <= 20     q3  0.0759
## 1  size <= 29.4     q1  0.0582
## 2    size <= 25     q2  0.0577
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.0003166667 
## Approximately 10% of max_count met: minutes 5e-04 
## Approximately 20% of max_count met: minutes 0.0008166667 
## Approximately 33% of max_count met: minutes 0.0014 
## Approximately 50% of max_count met: minutes 0.001883333 
## Approximately 75% of max_count met: minutes 0.002933333 
## Approximately 90% of max_count met: minutes 0.003483333 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 21 20 
## # of subgroups with sample size less than criteria 26 
## # of subgroups meeting all criteria = 177 
## # of subgroups fitted (Cox model estimable) = 177 
## *Subgroup Searching Minutes=* 0.003733333 
## Number of subgroups meeting HR threshold 0 
## NO subgroup candidate found (FS) 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.01796 2 
##    leaf.node control.mean control.size control.se depth
## 1          2         1.58        77.00       2.99     1
## 2          3        -4.47       623.00       1.15     1
## 11         4        -5.22       179.00       2.04     2
## 21         5         1.69       171.00       1.89     2
## 4          7        -6.87       324.00       1.69     2
##    leaf.node control.mean control.size control.se depth
## 21         5         1.69       171.00       1.89     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.02832378 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                 s0
## z1      0.06829145
## z2      .         
## z3      .         
## z4      0.48686291
## z5     -0.73974508
## size    .         
## grade3  .         
## Cox-LASSO selected: z1 z4 z5 
## Cox-LASSO not selected: z2 z3 size grade3 
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z4 z5 
## # of candidate subgroup factors= 7 
## [1] "size <= 29.4" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
## [6] "z4"           "z5"          
## Number of factors evaluated= 7 
## Confounders per grf screening q6 q4 q7 q5 q3 q1 q2 
##        Factors Labels VI(grf)
## 6           z4     q6  0.2141
## 4   size <= 35     q4  0.1769
## 7           z5     q7  0.1596
## 5           z1     q5  0.1365
## 3   size <= 20     q3  0.1181
## 1 size <= 29.4     q1  0.0991
## 2   size <= 25     q2  0.0956
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 105 
## Approximately 5% of max_count met: minutes 1e-04 
## Approximately 10% of max_count met: minutes 2e-04 
## Approximately 20% of max_count met: minutes 0.0005166667 
## Approximately 33% of max_count met: minutes 0.0007666667 
## Approximately 50% of max_count met: minutes 0.001233333 
## Approximately 75% of max_count met: minutes 0.002116667 
## Approximately 90% of max_count met: minutes 0.002416667 
## # of subgroups evaluated based on (up to) maxk-factor combinations 105 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 15 15 
## # of subgroups with sample size less than criteria 18 
## # of subgroups meeting all criteria = 81 
## # of subgroups fitted (Cox model estimable) = 81 
## *Subgroup Searching Minutes=* 0.002483333 
## Number of subgroups meeting HR threshold 0 
## NO subgroup candidate found (FS) 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.41962 2 
##    leaf.node control.mean control.size control.se depth
## 1          2        -5.05       689.00       1.07     1
## 11         4        -5.11       573.00       1.17     2
## 3          6        -8.44        83.00       3.56     2
##   leaf.node control.mean control.size control.se depth
## 1         2        -5.05       689.00       1.07     1
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## # of candidate subgroup factors= 10 
##  [1] "size <= 28.5" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q9 q5 q7 q8 q3 q2 q6 q10 q1 q4 
##         Factors Labels VI(grf)
## 9            z5     q9  0.2292
## 5            z1     q5  0.1849
## 7            z3     q7  0.0904
## 8            z4     q8  0.0818
## 3    size <= 20     q3  0.0766
## 2    size <= 25     q2  0.0749
## 6            z2     q6  0.0710
## 10       grade3    q10  0.0693
## 1  size <= 28.5     q1  0.0619
## 4    size <= 35     q4  0.0599
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.0003166667 
## Approximately 10% of max_count met: minutes 0.00065 
## Approximately 20% of max_count met: minutes 0.001116667 
## Approximately 33% of max_count met: minutes 0.002216667 
## Approximately 50% of max_count met: minutes 0.003133333 
## Approximately 75% of max_count met: minutes 0.004866667 
## Approximately 90% of max_count met: minutes 0.006083333 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 21 
## # of subgroups with sample size less than criteria 26 
## # of subgroups meeting all criteria = 177 
## # of subgroups fitted (Cox model estimable) = 177 
## *Subgroup Searching Minutes=* 0.00645 
## Number of subgroups meeting HR threshold 1 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  1 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n  E d1  HR L(HR) q9.0
## 1 159 62 35 1.4  0.84    0
## Consistency 0.805 
## Subgroup Consistency Minutes= 0.02055 
## NO subgroup found (FS) 
## Minutes forestsearch overall= 0.05845 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.41962 2 
##    leaf.node control.mean control.size control.se depth
## 1          2        -5.05       689.00       1.07     1
## 11         4        -5.11       573.00       1.17     2
## 3          6        -8.44        83.00       3.56     2
##   leaf.node control.mean control.size control.se depth
## 1         2        -5.05       689.00       1.07     1
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.0294912 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                 s0
## z1      0.07600026
## z2      .         
## z3      .         
## z4      0.38336979
## z5     -0.84959529
## size    .         
## grade3  .         
## Cox-LASSO selected: z1 z4 z5 
## Cox-LASSO not selected: z2 z3 size grade3 
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z4 z5 
## # of candidate subgroup factors= 7 
## [1] "size <= 28.5" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
## [6] "z4"           "z5"          
## Number of factors evaluated= 7 
## Confounders per grf screening q7 q5 q6 q2 q3 q4 q1 
##        Factors Labels VI(grf)
## 7           z5     q7  0.2751
## 5           z1     q5  0.2106
## 6           z4     q6  0.1208
## 2   size <= 25     q2  0.1118
## 3   size <= 20     q3  0.1075
## 4   size <= 35     q4  0.0914
## 1 size <= 28.5     q1  0.0828
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 105 
## Approximately 5% of max_count met: minutes 0.0001166667 
## Approximately 10% of max_count met: minutes 0.0002666667 
## Approximately 20% of max_count met: minutes 0.0005166667 
## Approximately 33% of max_count met: minutes 0.0009833333 
## Approximately 50% of max_count met: minutes 0.00135 
## Approximately 75% of max_count met: minutes 0.00185 
## Approximately 90% of max_count met: minutes 0.002216667 
## # of subgroups evaluated based on (up to) maxk-factor combinations 105 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 14 16 
## # of subgroups with sample size less than criteria 18 
## # of subgroups meeting all criteria = 81 
## # of subgroups fitted (Cox model estimable) = 81 
## *Subgroup Searching Minutes=* 0.002316667 
## Number of subgroups meeting HR threshold 0 
## NO subgroup candidate found (FS) 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.09494 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -3.20       690.00       1.05     1
## 2         4        -2.84       296.00       1.54     2
## 3         5         2.22        78.00       3.36     2
## 4         6        -4.87       316.00       1.58     2
##   leaf.node control.mean control.size control.se depth
## 3         5         2.22        78.00       3.36     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.8" "size <= 26.5" "size <= 21"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q8 q9 q7 q4 q1 q10 q6 q3 q5 q2 
##         Factors Labels VI(grf)
## 8            z4     q8  0.1267
## 9            z5     q9  0.1181
## 7            z3     q7  0.1042
## 4    size <= 35     q4  0.0993
## 1  size <= 29.8     q1  0.0981
## 10       grade3    q10  0.0965
## 6            z2     q6  0.0963
## 3    size <= 21     q3  0.0962
## 5            z1     q5  0.0917
## 2  size <= 26.5     q2  0.0729
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 2e-04 
## Approximately 10% of max_count met: minutes 0.0004333333 
## Approximately 20% of max_count met: minutes 0.0009166667 
## Approximately 33% of max_count met: minutes 0.00155 
## Approximately 50% of max_count met: minutes 0.002533333 
## Approximately 75% of max_count met: minutes 0.00365 
## Approximately 90% of max_count met: minutes 0.0046 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 24 
## # of subgroups with sample size less than criteria 25 
## # of subgroups meeting all criteria = 176 
## # of subgroups fitted (Cox model estimable) = 176 
## *Subgroup Searching Minutes=* 0.005233333 
## Number of subgroups meeting HR threshold 0 
## NO subgroup candidate found (FS) 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.09494 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -3.20       690.00       1.05     1
## 2         4        -2.84       296.00       1.54     2
## 3         5         2.22        78.00       3.36     2
## 4         6        -4.87       316.00       1.58     2
##   leaf.node control.mean control.size control.se depth
## 3         5         2.22        78.00       3.36     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.00234943 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                 s0
## z1      0.22103202
## z2     -0.56112951
## z3      0.41478275
## z4      0.71312294
## z5     -0.93657843
## size   -0.00321610
## grade3 -0.06430816
## Cox-LASSO selected: z1 z2 z3 z4 z5 size grade3 
## Cox-LASSO not selected:  
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z2 z3 z4 z5 grade3 
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.8" "size <= 26.5" "size <= 21"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q8 q9 q7 q4 q1 q10 q6 q3 q5 q2 
##         Factors Labels VI(grf)
## 8            z4     q8  0.1267
## 9            z5     q9  0.1181
## 7            z3     q7  0.1042
## 4    size <= 35     q4  0.0993
## 1  size <= 29.8     q1  0.0981
## 10       grade3    q10  0.0965
## 6            z2     q6  0.0963
## 3    size <= 21     q3  0.0962
## 5            z1     q5  0.0917
## 2  size <= 26.5     q2  0.0729
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.0002333333 
## Approximately 10% of max_count met: minutes 0.0004666667 
## Approximately 20% of max_count met: minutes 0.00085 
## Approximately 33% of max_count met: minutes 0.001766667 
## Approximately 50% of max_count met: minutes 0.002783333 
## Approximately 75% of max_count met: minutes 0.0036 
## Approximately 90% of max_count met: minutes 0.004216667 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 24 
## # of subgroups with sample size less than criteria 25 
## # of subgroups meeting all criteria = 176 
## # of subgroups fitted (Cox model estimable) = 176 
## *Subgroup Searching Minutes=* 0.004666667 
## Number of subgroups meeting HR threshold 0 
## NO subgroup candidate found (FS)
\end{verbatim}
\begin{alltt}
\hlstd{t.now}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}
\hlstd{t.min}\hlkwb{<-}\hlstd{(t.now}\hlopt{-}\hlstd{t.start)}\hlopt{/}\hlnum{60}

\hlkwd{print}\hlstd{(}\hlkwd{table}\hlstd{(res}\hlopt{$}\hlstd{analysis))}
\end{alltt}
\begin{verbatim}
## 
##     FSl    FSlg     GRF  GRF.60  VT(24)  VT(36) VT#(24) VT#(36) 
##   20000   20000   20000   20000   20000   20000   20000   20000
\end{verbatim}
\begin{alltt}
\hlstd{check}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlkwd{c}\hlstd{(}\hlkwd{table}\hlstd{(res}\hlopt{$}\hlstd{analysis))}\hlopt{-}\hlstd{Nsims)}
\hlkwa{if}\hlstd{(}\hlkwd{all}\hlstd{(check}\hlopt{!=}\hlnum{0}\hlstd{))} \hlkwd{stop}\hlstd{(}\hlstr{"All analyses not complete"}\hlstd{)}

\hlstd{dgm_alt}\hlkwb{<-}\hlstd{dgm}
\hlstd{outres}\hlkwb{<-}\hlkwd{out.results}\hlstd{(}\hlkwc{res}\hlstd{=res,}\hlkwc{dgm}\hlstd{=dgm,}\hlkwc{output.file}\hlstd{=output.file,}\hlkwc{t.min}\hlstd{=t.min,}\hlkwc{out_analysis}\hlstd{=}\hlstr{"FSl"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] "results/oc_sims=20000_m4a-Noise=0_N=700_null_ktreat=0.9_v0-4cuts.Rdata"
##      sim sizeH_true propH_true sizeHc_true propHc_true any.H size.H size.Hc
##    <int>      <num>      <num>       <int>       <num> <num>  <num>   <int>
## 1:     1          0          0         700           1     0      0     700
## 2:     1          0          0         700           1     0      0     700
## 3:     1          0          0         700           1     0      0     700
## 4:     1          0          0         700           1     0      0     700
## 5:     1          0          0         700           1     0      0     700
## 6:     1          0          0         700           1     0      0     700
##       ppv   npv specificity sensitivity found.1 found.2 found.both found.al3
##    <lgcl> <num>       <num>       <num>   <int>   <int>      <num>     <num>
## 1:     NA     1           1          NA       0       0          0         0
## 2:     NA     1           1          NA       0       0          0         0
## 3:     NA     1           1          NA      NA      NA         NA        NA
## 4:     NA     1           1          NA      NA      NA         NA        NA
## 5:     NA     1           1          NA       0       0          0         0
## 6:     NA     1           1          NA       0       0          0         0
##    hr.H.true hr.Hc.true hr.H.hat hr.Hc.hat   b1.H   b2.H b1.Hc       b2.Hc
##       <lgcl>      <num>    <num>     <num> <lgcl> <lgcl> <num>       <num>
## 1:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
## 2:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
## 3:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
## 4:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
## 5:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
## 6:        NA  0.6155054       NA 0.6155054     NA     NA     0 -0.08552157
##       p.cens analysis   taumax    hr.itt     l.itt    u.itt hr.adj.itt
##        <num>   <char>    <num>     <num>     <num>    <num>      <num>
## 1: 0.4642857      FSl 81.69660 0.6155054 0.5014207 0.755547  0.5906047
## 2: 0.4642857     FSlg 49.01796 0.6155054 0.5014207 0.755547  0.5906047
## 3: 0.4642857      GRF 81.69660 0.6155054 0.5014207 0.755547  0.5906047
## 4: 0.4642857   GRF.60 49.01796 0.6155054 0.5014207 0.755547  0.5906047
## 5: 0.4642857   VT(24) 81.69660 0.6155054 0.5014207 0.755547  0.5906047
## 6: 0.4642857  VT#(24) 81.69660 0.6155054 0.5014207 0.755547  0.5906047
##    l.adj.itt u.adj.itt l.H.true u.H.true l.Hc.true u.Hc.true l.H.hat u.H.hat
##        <num>     <num>   <lgcl>   <lgcl>     <num>     <num>   <num>   <num>
## 1:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
## 2:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
## 3:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
## 4:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
## 5:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
## 6:  0.480604 0.7257825       NA       NA 0.5014207  0.755547      NA      NA
##     l.Hc.hat u.Hc.hat
##        <num>    <num>
## 1: 0.5014207 0.755547
## 2: 0.5014207 0.755547
## 3: 0.5014207 0.755547
## 4: 0.5014207 0.755547
## 5: 0.5014207 0.755547
## 6: 0.5014207 0.755547
## Subgroup HRs: H, H^c, Causal= NA 0.701027 0.701027 
## Simulations= 20000 
## Avg censoring= 0.4617969 
## Min,Max,Avg tau.max= 71.81152 83.99787 81.70761 
## P(H) approximation at causal(Hrc), n=60, approx= 0.701027 0.03396618 
## P(H) approximation at plim(Hrc), n=60, approx= 0.7066595 0.03564707 
## Minutes,hours 445.905 7.431749 
##                    FSl    FSlg     GRF  GRF.60  VT(24) VT#(24)  VT(36) VT#(36)
## any.H            0.070   0.050   0.250   0.050   0.030   0.020   0.030   0.020
## sensH              NaN     NaN     NaN     NaN     NaN     NaN     NaN     NaN
## sensHc           0.990   0.990   0.970   0.990   1.000   1.000   1.000   1.000
## ppH              0.000   0.000   0.000   0.000   0.000   0.000   0.000   0.000
## ppHc             1.000   1.000   1.000   1.000   1.000   1.000   1.000   1.000
## Avg(#H)         98.000  99.000  88.000  77.000  78.000  77.000  79.000  76.000
## minH            61.000  61.000  60.000  60.000  60.000  60.000  60.000  60.000
## maxH           287.000 287.000 328.000 199.000 168.000 160.000 199.000 124.000
## Avg(#Hc)       694.000 695.000 678.000 696.000 698.000 699.000 697.000 699.000
## minHc          413.000 413.000 372.000 501.000 532.000 540.000 501.000 576.000
## maxHc          700.000 700.000 700.000 700.000 700.000 700.000 700.000 700.000
## hat(H*)            NaN     NaN     NaN     NaN     NaN     NaN     NaN     NaN
## hat(hat[H])      1.797   1.795   1.532   1.524   1.298   1.408   1.309   1.579
## hat(Hc*)         0.780   0.781   0.739   0.736   0.738   0.744   0.732   0.745
## hat(hat[Hc])     0.691   0.690   0.670   0.676   0.693   0.691   0.686   0.686
## hat(H*)all         NaN     NaN     NaN     NaN     NaN     NaN     NaN     NaN
## hat(Hc*)all      0.707   0.707   0.707   0.707   0.707   0.707   0.707   0.707
## hat(ITT)all      0.707   0.707   0.707   0.707   0.707   0.707   0.707   0.707
## hat(ITTadj)all   0.664   0.664   0.664   0.664   0.664   0.664   0.664   0.664
\end{verbatim}
\begin{alltt}
\hlstd{missC}\hlkwb{<-}\hlkwd{tab_tests}\hlstd{(}\hlkwc{res}\hlstd{=res)}

\hlstd{pA} \hlkwb{<-} \hlkwd{as.character}\hlstd{(}\hlkwd{round}\hlstd{(outres}\hlopt{$}\hlstd{pAnyH.approx2,}\hlnum{4}\hlstd{))}
\hlstd{tabsim_missC}\hlkwb{<-}\hlkwd{get_tabsim}\hlstd{(}\hlkwc{missC}\hlstd{=missC,}\hlkwc{pA}\hlstd{=pA,}\hlkwc{est_names}\hlstd{=est_names,}\hlkwc{stat_names}\hlstd{=stat_names,}\hlkwc{mod.harm}\hlstd{=mod.harm,}\hlkwc{Nsims}\hlstd{=Nsims)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{table}[!h]
\centering
\caption{\label{tab:r null}Average classification rates: ${avg}\vert \hat{H} \vert$, ${min}\vert \hat{H} \vert$, and ${max}\vert \hat{H} \vert$, denote the average, 
minimum, and maximum of the number of subjects in the estimated subgroup $\hat{H}$ (analogously for $\hat{H}^{c}$).  
Note that under the null $sens(\hat{H})$ is undefined and $ppv(\hat{H})=0$.}
\centering
\fontsize{9}{11}\selectfont
\begin{tabular}[t]{lcccccccc}
\toprule
  & $FS_{g}$ & $FS_{lg}$ & $GRF$ & $GRF_{60}$ & $VT(24)$ & ${VT}^{\#}(24)$ & $VT(36)$ & ${VT}^{\#}(36)$\\
\midrule
\addlinespace[0.3em]
\multicolumn{9}{l}{\textbf{Finding H}}\\
\hspace{1em}any(H) & 0.07 & 0.05 & 0.25 & 0.05 & 0.03 & 0.02 & 0.03 & 0.02\\
\hspace{1em}${sens}(\hat{H})$ & . & . & . & . & . & . & . & .\\
\hspace{1em}${sens}(\hat{H}^{C})$ & 0.99 & 0.99 & 0.97 & 0.99 & 1 & 1 & 1 & 1\\
\hspace{1em}${ppv}(\hat{H})$ & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\hspace{1em}${ppv}(\hat{H}^{C})$ & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\addlinespace[0.3em]
\multicolumn{9}{l}{\textbf{Size of H and H-complement}}\\
\hspace{1em}${avg}\vert \hat{H} \vert$ & 98 & 99 & 88 & 77 & 78 & 77 & 79 & 76\\
\hspace{1em}${min}\vert \hat{H} \vert$ & 61 & 61 & 60 & 60 & 60 & 60 & 60 & 60\\
\hspace{1em}${max}\vert \hat{H} \vert$ & 287 & 287 & 328 & 199 & 168 & 160 & 199 & 124\\
\hspace{1em}${avg}\vert \hat{H}^{C} \vert$ & 694 & 695 & 678 & 696 & 698 & 699 & 697 & 699\\
\hspace{1em}${min}\vert \hat{H}^{C} \vert$ & 413 & 413 & 372 & 501 & 532 & 540 & 501 & 576\\
\hspace{1em}${max}\vert \hat{H}^{C} \vert$ & 700 & 700 & 700 & 700 & 700 & 700 & 700 & 700\\
\bottomrule
\multicolumn{9}{l}{\rule{0pt}{1em}\textit{Note: } Number of simulations= 20000 .}\\
\multicolumn{9}{l}{\rule{0pt}{1em}\textit{Note: } Probability approximation= 0.0356 .}\\
\end{tabular}
\end{table}




\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mod.harm} \hlkwb{<-} \hlstr{"alt"}
\hlstd{hrH.target} \hlkwb{<-} \hlnum{2.0}

\hlstd{this.dgm}\hlkwb{<-}\hlkwd{get.dgm4.OC}\hlstd{(}\hlkwc{mod.harm}\hlstd{=mod.harm,}\hlkwc{N}\hlstd{=N,}\hlkwc{k.treat}\hlstd{=k.treat,}\hlkwc{model.index}\hlstd{=model.index,}\hlkwc{sol_tol}\hlstd{=}\hlnum{10}\hlopt{^-}\hlnum{8}\hlstd{,}
\hlkwc{hrH.target}\hlstd{=hrH.target,}\hlkwc{cens.type}\hlstd{=cens.type,}\hlkwc{out.loc}\hlstd{=out.loc,}\hlkwc{file.index}\hlstd{=file.index,}\hlkwc{details}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{parms_torand}\hlstd{=}\hlnum{FALSE}\hlstd{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{figure/r_hrh2-1} 
\begin{kframe}\begin{verbatim}
## Super-population empirical harm and non-harm hazard ratios= 2.000007 0.6466405 
## Causal HR (empirical ITT)= 0.7057463
\end{verbatim}
\begin{alltt}
\hlstd{dgm}\hlkwb{<-}\hlstd{this.dgm}\hlopt{$}\hlstd{dgm}
\hlstd{output.file}\hlkwb{<-}\hlstd{this.dgm}\hlopt{$}\hlstd{out.file}

\hlkwa{if}\hlstd{(}\hlopt{!}\hlkwd{is.null}\hlstd{(output.file)} \hlopt{& !}\hlkwd{grepl}\hlstd{(mod.harm,output.file))} \hlkwd{stop}\hlstd{(}\hlstr{"Wrong file name for mod.harm"}\hlstd{)}

\hlcom{# Show first simulation}
\hlcom{#ans1 <- oc_analyses_m4_FS4(2)}

\hlstd{t.start}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}
\hlstd{res} \hlkwb{<-} \hlkwd{foreach}\hlstd{(}
    \hlkwc{sim} \hlstd{=} \hlkwd{seq_len}\hlstd{(Nsims),}
    \hlkwc{.options.future}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{seed}\hlstd{=}\hlnum{TRUE}\hlstd{),}
    \hlkwc{.combine}\hlstd{=}\hlstr{"rbind"}\hlstd{,}
    \hlkwc{.errorhandling}\hlstd{=}\hlstr{"pass"}
  \hlstd{)} \hlopt{%dofuture%} \hlstd{\{}
\hlstd{ans} \hlkwb{<-} \hlkwd{oc_analyses_m4FourCuts_FS4}\hlstd{(sim)}
\hlkwd{return}\hlstd{(ans)}
\hlstd{\}}
\end{alltt}
\begin{verbatim}
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.86072 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -4.39       509.00       1.22     1
## 2         3         2.61       191.00       2.23     1
## 3         4        -3.89       213.00       1.97     2
## 4         5         4.31        62.00       2.96     2
## 5         6        -5.79       313.00       1.61     2
## 6         7         5.68       112.00       2.82     2
##   leaf.node control.mean control.size control.se depth
## 6         7         5.68       112.00       2.82     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.4" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q6 q7 q5 q9 q8 q4 q10 q3 q1 q2 
##         Factors Labels VI(grf)
## 6            z2     q6  0.2600
## 7            z3     q7  0.2139
## 5            z1     q5  0.1753
## 9            z5     q9  0.0652
## 8            z4     q8  0.0596
## 4    size <= 35     q4  0.0561
## 10       grade3    q10  0.0485
## 3    size <= 20     q3  0.0456
## 1  size <= 29.4     q1  0.0400
## 2    size <= 25     q2  0.0358
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.0002166667 
## Approximately 10% of max_count met: minutes 0.0004166667 
## Approximately 20% of max_count met: minutes 0.0008333333 
## Approximately 33% of max_count met: minutes 0.001416667 
## Approximately 50% of max_count met: minutes 0.002566667 
## Approximately 75% of max_count met: minutes 0.003783333 
## Approximately 90% of max_count met: minutes 0.004333333 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 21 20 
## # of subgroups with sample size less than criteria 26 
## # of subgroups meeting all criteria = 177 
## # of subgroups fitted (Cox model estimable) = 177 
## *Subgroup Searching Minutes=* 0.004583333 
## Number of subgroups meeting HR threshold 6 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  6 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n  E d1   HR L(HR) q6.0 q6.1 q7.0 q7.1 q5.0 q5.1
## 1  95 78 44 1.74  1.11    0    0    0    1    0    1
## 2 122 95 52 1.48  0.98    0    1    0    0    0    1
## 3 100 80 41 1.47  0.94    0    0    0    0    0    1
## 4  77 55 30 1.41  0.83    0    0    0    0    0    1
## 5  90 64 32 1.31  0.80    0    0    0    0    0    1
## 6  67 39 21 1.30  0.69    0    0    0    1    0    0
## Consistency 0.9675 
## # of splits= 400 
## Model, % Consistency Met= {z3} {z1} 0.9675 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.01863333 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.03615 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 48.86072 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -4.39       509.00       1.22     1
## 2         3         2.61       191.00       2.23     1
## 3         4        -3.89       213.00       1.97     2
## 4         5         4.31        62.00       2.96     2
## 5         6        -5.79       313.00       1.61     2
## 6         7         5.68       112.00       2.82     2
##   leaf.node control.mean control.size control.se depth
## 6         7         5.68       112.00       2.82     2
## GRF subgroup NOT found 
## NO GRF cuts meeting delta(RMST): dmin.grf= 12 
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.01355153 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                 s0
## z1      0.32115232
## z2      .         
## z3      0.09066173
## z4      0.48299291
## z5     -0.78083587
## size    .         
## grade3  .         
## Cox-LASSO selected: z1 z3 z4 z5 
## Cox-LASSO not selected: z2 size grade3 
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z3 z4 z5 
## # of candidate subgroup factors= 8 
## [1] "size <= 29.4" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
## [6] "z3"           "z4"           "z5"          
## Number of factors evaluated= 8 
## Confounders per grf screening q6 q5 q7 q8 q4 q3 q2 q1 
##        Factors Labels VI(grf)
## 6           z3     q6  0.3739
## 5           z1     q5  0.2273
## 7           z4     q7  0.0830
## 8           z5     q8  0.0790
## 4   size <= 35     q4  0.0683
## 3   size <= 20     q3  0.0623
## 2   size <= 25     q2  0.0534
## 1 size <= 29.4     q1  0.0528
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 136 
## Approximately 5% of max_count met: minutes 2e-04 
## Approximately 10% of max_count met: minutes 0.0003833333 
## Approximately 20% of max_count met: minutes 0.0006833333 
## Approximately 33% of max_count met: minutes 0.0012 
## Approximately 50% of max_count met: minutes 0.00215 
## Approximately 75% of max_count met: minutes 0.002966667 
## Approximately 90% of max_count met: minutes 0.0039 
## # of subgroups evaluated based on (up to) maxk-factor combinations 136 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 16 16 
## # of subgroups with sample size less than criteria 19 
## # of subgroups meeting all criteria = 111 
## # of subgroups fitted (Cox model estimable) = 111 
## *Subgroup Searching Minutes=* 0.004033333 
## Number of subgroups meeting HR threshold 5 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  5 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n  E d1   HR L(HR) q6.0 q6.1 q5.0 q5.1 q7.0
## 1  95 78 44 1.74  1.11    0    1    0    1    0
## 2 100 80 41 1.47  0.94    0    0    0    1    0
## 3  77 55 30 1.41  0.83    0    0    0    1    0
## 4  90 64 32 1.31  0.80    0    0    0    1    0
## 5  67 39 21 1.30  0.69    0    1    0    0    0
## Consistency 0.9675 
## # of splits= 400 
## Model, % Consistency Met= {z3} {z1} 0.9675 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.02013333 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.04918333 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.18697 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -3.68       689.00       1.11     1
## 2         2        -4.54       506.00       1.25     2
## 3         4       -10.91        90.00       3.15     2
## 4         5         7.23       104.00       3.15     2
##   leaf.node control.mean control.size control.se depth
## 4         5         7.23       104.00       3.15     2
## GRF subgroup found 
## All splits 
## [1] "z1 <= 0" "z3 <= 0"
## Terminating node at max.diff (sg.harm.id) 
## [1] "z3 <= 0"
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## Factors per GRF: z1 <= 0 z3 <= 0 
## Initial GRF cuts included z1 <= 0 z3 <= 0 
## # of candidate subgroup factors= 10 
##  [1] "size <= 28.5" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q7 q9 q8 q5 q6 q10 q3 q2 q4 q1 
##         Factors Labels VI(grf)
## 7            z3     q7  0.2509
## 9            z5     q9  0.1665
## 8            z4     q8  0.1259
## 5            z1     q5  0.1021
## 6            z2     q6  0.0986
## 10       grade3    q10  0.0570
## 3    size <= 20     q3  0.0546
## 2    size <= 25     q2  0.0503
## 4    size <= 35     q4  0.0501
## 1  size <= 28.5     q1  0.0441
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 3e-04 
## Approximately 10% of max_count met: minutes 0.0005833333 
## Approximately 20% of max_count met: minutes 0.0015 
## Approximately 33% of max_count met: minutes 0.002866667 
## Approximately 50% of max_count met: minutes 0.004233333 
## Approximately 75% of max_count met: minutes 0.005766667 
## Approximately 90% of max_count met: minutes 0.006783333 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 21 
## # of subgroups with sample size less than criteria 26 
## # of subgroups meeting all criteria = 177 
## # of subgroups fitted (Cox model estimable) = 177 
## *Subgroup Searching Minutes=* 0.00725 
## Number of subgroups meeting HR threshold 8 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  8 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n   E d1   HR L(HR) q7.0 q7.1 q9.0 q9.1 q8.0 q8.1 q5.0 q5.1
## 1 159  66 40 1.75  1.07    0    1    0    1    0    0    0    0
## 2 104  83 47 1.65  1.06    0    1    0    0    0    0    0    1
## 3 139  80 50 1.45  0.92    0    1    0    0    0    0    0    0
## 4  76  42 26 1.41  0.75    0    1    0    0    0    0    0    0
## 5 231 132 78 1.38  0.97    0    1    0    0    0    0    0    0
## 6 166  97 59 1.35  0.90    0    1    0    0    0    0    0    0
## 7 141 101 60 1.29  0.87    0    1    0    0    0    1    0    0
## 8 195  80 44 1.28  0.82    0    0    0    1    0    0    0    0
## Consistency 0.98 
## # of splits= 400 
## Model, % Consistency Met= {z3} {z5} 0.98 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.01793333 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.05941667 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.18697 2 
##   leaf.node control.mean control.size control.se depth
## 1         2        -3.68       689.00       1.11     1
## 2         2        -4.54       506.00       1.25     2
## 3         4       -10.91        90.00       3.15     2
## 4         5         7.23       104.00       3.15     2
##   leaf.node control.mean control.size control.se depth
## 4         5         7.23       104.00       3.15     2
## GRF subgroup found 
## All splits 
## [1] "z1 <= 0" "z3 <= 0"
## Terminating node at max.diff (sg.harm.id) 
## [1] "z3 <= 0"
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.03027528 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                s0
## z1      0.3191255
## z2      .        
## z3      .        
## z4      0.3696701
## z5     -0.8302139
## size    .        
## grade3  .        
## Cox-LASSO selected: z1 z4 z5 
## Cox-LASSO not selected: z2 z3 size grade3 
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z4 z5 
## Factors per GRF: z1 <= 0 z3 <= 0 
## Initial GRF cuts included z1 <= 0 z3 <= 0 
## Factors included per GRF (not in lasso) z3 <= 0 
## # of candidate subgroup factors= 8 
## [1] "size <= 28.5" "size <= 25"   "size <= 20"   "size <= 35"   "z1"          
## [6] "z4"           "z5"           "z3 <= 0"     
## Number of factors evaluated= 8 
## Confounders per grf screening q8 q7 q6 q5 q3 q4 q2 q1 
##        Factors Labels VI(grf)
## 8      z3 <= 0     q8  0.3130
## 7           z5     q7  0.1799
## 6           z4     q6  0.1495
## 5           z1     q5  0.1057
## 3   size <= 20     q3  0.0690
## 4   size <= 35     q4  0.0681
## 2   size <= 25     q2  0.0622
## 1 size <= 28.5     q1  0.0526
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 136 
## Approximately 5% of max_count met: minutes 0.0001833333 
## Approximately 10% of max_count met: minutes 0.0004333333 
## Approximately 20% of max_count met: minutes 0.001033333 
## Approximately 33% of max_count met: minutes 0.001433333 
## Approximately 50% of max_count met: minutes 0.002 
## Approximately 75% of max_count met: minutes 0.002966667 
## Approximately 90% of max_count met: minutes 0.003466667 
## # of subgroups evaluated based on (up to) maxk-factor combinations 136 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 15 17 
## # of subgroups with sample size less than criteria 19 
## # of subgroups meeting all criteria = 111 
## # of subgroups fitted (Cox model estimable) = 111 
## *Subgroup Searching Minutes=* 0.003716667 
## Number of subgroups meeting HR threshold 7 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  7 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n   E d1   HR L(HR) q8.0 q8.1 q7.0 q7.1 q6.0 q6.1 q5.0
## 1 159  66 40 1.75  1.07    1    0    0    1    0    0    0
## 2 104  83 47 1.65  1.06    1    0    0    0    0    0    0
## 3 139  80 50 1.45  0.92    1    0    0    0    0    0    0
## 4  76  42 26 1.41  0.75    1    0    0    0    0    0    0
## 5 231 132 78 1.38  0.97    1    0    0    0    0    0    0
## 6 166  97 59 1.35  0.90    1    0    0    0    0    0    0
## 7 141 101 60 1.29  0.87    1    0    0    0    0    1    0
## Consistency 0.98 
## # of splits= 400 
## Model, % Consistency Met= !{z3 <= 0} {z5} 0.98 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.01971667 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.05111667 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.86585 2 
##    leaf.node control.mean control.size control.se depth
## 1          2        -3.60       523.00       1.22     1
## 2          3         2.64       177.00       2.43     1
## 11         4        -4.36       332.00       1.44     2
## 3          6        -4.18       214.00       2.14     2
## 4          7         6.25       137.00       2.66     2
##   leaf.node control.mean control.size control.se depth
## 4         7         6.25       137.00       2.66     2
## GRF subgroup found 
## All splits 
## [1] "z4 <= 0" "z1 <= 0" "z3 <= 0"
## Terminating node at max.diff (sg.harm.id) 
## [1] "z3 <= 0"
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## Default cuts included (1st 20) 
## Categorical: z1 z2 z3 z4 z5 grade3 
## Factors per GRF: z4 <= 0 z1 <= 0 z3 <= 0 
## Initial GRF cuts included z4 <= 0 z1 <= 0 z3 <= 0 
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.8" "size <= 26.5" "size <= 21"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q5 q8 q7 q10 q9 q3 q1 q6 q4 q2 
##         Factors Labels VI(grf)
## 5            z1     q5  0.2088
## 8            z4     q8  0.1477
## 7            z3     q7  0.1190
## 10       grade3    q10  0.1090
## 9            z5     q9  0.0889
## 3    size <= 21     q3  0.0737
## 1  size <= 29.8     q1  0.0736
## 6            z2     q6  0.0656
## 4    size <= 35     q4  0.0617
## 2  size <= 26.5     q2  0.0520
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.00025 
## Approximately 10% of max_count met: minutes 0.0006166667 
## Approximately 20% of max_count met: minutes 0.0012 
## Approximately 33% of max_count met: minutes 0.001933333 
## Approximately 50% of max_count met: minutes 0.003333333 
## Approximately 75% of max_count met: minutes 0.004783333 
## Approximately 90% of max_count met: minutes 0.0054 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 22 
## # of subgroups with sample size less than criteria 25 
## # of subgroups meeting all criteria = 176 
## # of subgroups fitted (Cox model estimable) = 176 
## *Subgroup Searching Minutes=* 0.005933333 
## Number of subgroups meeting HR threshold 8 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  8 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n   E d1   HR L(HR) q5.0 q5.1 q8.0 q8.1 q7.0 q7.1 q10.0 q10.1
## 1  86  70 37 1.70  1.06    0    1    0    0    0    1     0     0
## 2  75  49 23 1.59  0.90    0    1    0    0    0    0     0     0
## 3  69  44 23 1.50  0.82    0    0    0    0    0    0     0     1
## 4  86  55 27 1.38  0.81    0    0    0    0    0    0     0     1
## 5 137 102 53 1.35  0.92    0    0    0    1    0    1     0     0
## 6  90  60 30 1.35  0.81    0    1    0    0    0    0     0     0
## 7  82  56 27 1.26  0.75    0    1    0    0    0    0     0     1
## 8 130  88 45 1.25  0.82    0    0    0    1    0    0     0     1
## Consistency 0.9725 
## # of splits= 400 
## Model, % Consistency Met= {z1} {z3} 0.9725 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.01833333 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.05841667 
## FS: GRF stage for cut selection with dmin,tau= 12 0.6 
## tau, maxdepth= 49.86585 2 
##    leaf.node control.mean control.size control.se depth
## 1          2        -3.60       523.00       1.22     1
## 2          3         2.64       177.00       2.43     1
## 11         4        -4.36       332.00       1.44     2
## 3          6        -4.18       214.00       2.14     2
## 4          7         6.25       137.00       2.66     2
##   leaf.node control.mean control.size control.se depth
## 4         7         6.25       137.00       2.66     2
## GRF subgroup found 
## All splits 
## [1] "z4 <= 0" "z1 <= 0" "z3 <= 0"
## Terminating node at max.diff (sg.harm.id) 
## [1] "z3 <= 0"
## # of continuous/categorical characteristics 1 6 
## Continuous characteristics: size 
## Categorical characteristics: z1 z2 z3 z4 z5 grade3 
## CV lambda = 0.003052534 
## 7 x 1 sparse Matrix of class "dgCMatrix"
##                  s0
## z1      0.456793411
## z2     -0.559915450
## z3      0.572323151
## z4      0.706710215
## z5     -0.902306015
## size   -0.004450463
## grade3 -0.019602502
## Cox-LASSO selected: z1 z2 z3 z4 z5 size grade3 
## Cox-LASSO not selected:  
## Default cuts included from Lasso: 
## Categorical after Lasso: z1 z2 z3 z4 z5 grade3 
## Factors per GRF: z4 <= 0 z1 <= 0 z3 <= 0 
## Initial GRF cuts included z4 <= 0 z1 <= 0 z3 <= 0 
## Factors included per GRF (not in lasso)  
## # of candidate subgroup factors= 10 
##  [1] "size <= 29.8" "size <= 26.5" "size <= 21"   "size <= 35"   "z1"          
##  [6] "z2"           "z3"           "z4"           "z5"           "grade3"      
## Number of factors evaluated= 10 
## Confounders per grf screening q5 q8 q7 q10 q9 q3 q1 q6 q4 q2 
##         Factors Labels VI(grf)
## 5            z1     q5  0.2088
## 8            z4     q8  0.1477
## 7            z3     q7  0.1190
## 10       grade3    q10  0.1090
## 9            z5     q9  0.0889
## 3    size <= 21     q3  0.0737
## 1  size <= 29.8     q1  0.0736
## 6            z2     q6  0.0656
## 4    size <= 35     q4  0.0617
## 2  size <= 26.5     q2  0.0520
## Number of possible configurations (<= maxk): maxk, # <= maxk 2 210 
## Approximately 5% of max_count met: minutes 0.0002833333 
## Approximately 10% of max_count met: minutes 6e-04 
## Approximately 20% of max_count met: minutes 0.001133333 
## Approximately 33% of max_count met: minutes 0.001766667 
## Approximately 50% of max_count met: minutes 0.003 
## Approximately 75% of max_count met: minutes 0.004533333 
## Approximately 90% of max_count met: minutes 0.005683333 
## # of subgroups evaluated based on (up to) maxk-factor combinations 210 
## % of all-possible combinations (<= maxk) 100 
## k.max= 2 
## Events criteria for control,exp= 10 10 
## # of subgroups with events less than criteria: control, experimental 18 22 
## # of subgroups with sample size less than criteria 25 
## # of subgroups meeting all criteria = 176 
## # of subgroups fitted (Cox model estimable) = 176 
## *Subgroup Searching Minutes=* 0.005983333 
## Number of subgroups meeting HR threshold 8 
## Subgroup candidate(s) found (FS) 
## # of candidate subgroups (meeting HR criteria) =  8 
## SGs (1st 10) meeting screening thresholds sorted by sg_focus= hr 
##     n   E d1   HR L(HR) q5.0 q5.1 q8.0 q8.1 q7.0 q7.1 q10.0 q10.1
## 1  86  70 37 1.70  1.06    0    1    0    0    0    1     0     0
## 2  75  49 23 1.59  0.90    0    1    0    0    0    0     0     0
## 3  69  44 23 1.50  0.82    0    0    0    0    0    0     0     1
## 4  86  55 27 1.38  0.81    0    0    0    0    0    0     0     1
## 5 137 102 53 1.35  0.92    0    0    0    1    0    1     0     0
## 6  90  60 30 1.35  0.81    0    1    0    0    0    0     0     0
## 7  82  56 27 1.26  0.75    0    1    0    0    0    0     0     1
## 8 130  88 45 1.25  0.82    0    0    0    1    0    0     0     1
## Consistency 0.9725 
## # of splits= 400 
## Model, % Consistency Met= {z1} {z3} 0.9725 
## SG focus= hr 
## Subgroup Consistency Minutes= 0.01728333 
## Subgroup found (FS) 
## Minutes forestsearch overall= 0.06036667
\end{verbatim}
\begin{alltt}
\hlstd{t.now}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}
\hlstd{t.min}\hlkwb{<-}\hlstd{(t.now}\hlopt{-}\hlstd{t.start)}\hlopt{/}\hlnum{60}


\hlkwd{print}\hlstd{(}\hlkwd{table}\hlstd{(res}\hlopt{$}\hlstd{analysis))}
\end{alltt}
\begin{verbatim}
## 
##     FSl    FSlg     GRF  GRF.60  VT(24)  VT(36) VT#(24) VT#(36) 
##   20000   20000   20000   20000   20000   20000   20000   20000
\end{verbatim}
\begin{alltt}
\hlstd{check}\hlkwb{<-}\hlkwd{c}\hlstd{(}\hlkwd{c}\hlstd{(}\hlkwd{table}\hlstd{(res}\hlopt{$}\hlstd{analysis))}\hlopt{-}\hlstd{Nsims)}
\hlkwa{if}\hlstd{(}\hlkwd{all}\hlstd{(check}\hlopt{!=}\hlnum{0}\hlstd{))} \hlkwd{stop}\hlstd{(}\hlstr{"All analyses not complete"}\hlstd{)}

\hlstd{dgm_alt}\hlkwb{<-}\hlstd{dgm}

\hlstd{outres}\hlkwb{<-}\hlkwd{out.results}\hlstd{(}\hlkwc{res}\hlstd{=res,}\hlkwc{dgm}\hlstd{=dgm,}\hlkwc{output.file}\hlstd{=output.file,}\hlkwc{t.min}\hlstd{=t.min,}\hlkwc{out_analysis}\hlstd{=}\hlstr{"FSl"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] "results/oc_sims=20000_m4a-Noise=0_N=700_alt_ktreat=0.9_hrH=2_v0-4cuts.Rdata"
##      sim sizeH_true propH_true sizeHc_true propHc_true any.H size.H size.Hc
##    <int>      <num>      <num>       <int>       <num> <num>  <num>   <int>
## 1:     1         95  0.1357143         605   0.8642857     1     95     605
## 2:     1         95  0.1357143         605   0.8642857     1     95     605
## 3:     1         95  0.1357143         605   0.8642857     1     95     605
## 4:     1         95  0.1357143         605   0.8642857     0      0     700
## 5:     1         95  0.1357143         605   0.8642857     0      0     700
## 6:     1         95  0.1357143         605   0.8642857     0      0     700
##      ppv   npv specificity sensitivity found.1 found.2 found.both found.al3
##    <num> <num>       <num>       <num>   <num>   <num>      <num>     <num>
## 1:     1     1   1.0000000           1       0       0          0         0
## 2:     1     1   1.0000000           1       0       0          0         0
## 3:     1     1   1.0000000           1      NA      NA         NA        NA
## 4:     0     1   0.8642857           0      NA      NA         NA         0
## 5:     0     1   0.8642857           0       0       0          0         0
## 6:     0     1   0.8642857           0       0       0          0         0
##    hr.H.true hr.Hc.true hr.H.hat hr.Hc.hat  b1.H       b2.H     b1.Hc
##        <num>      <num>    <num>     <num> <num>      <num>     <num>
## 1:   1.74466  0.5577464  1.74466 0.5577464     0 -0.2553474 0.0000000
## 2:   1.74466  0.5577464  1.74466 0.5577464     0 -0.2553474 0.0000000
## 3:   1.74466  0.5577464  1.74466 0.5577464     0 -0.2553474 0.0000000
## 4:   1.74466  0.5577464       NA 0.6688550    NA         NA 0.1111086
## 5:   1.74466  0.5577464       NA 0.6688550    NA         NA 0.1111086
## 6:   1.74466  0.5577464       NA 0.6688550    NA         NA 0.1111086
##          b2.Hc    p.cens analysis   taumax   hr.itt     l.itt     u.itt
##          <num>     <num>   <char>    <num>    <num>     <num>     <num>
## 1: -0.08889407 0.4514286      FSl 81.43453 0.668855 0.5464683 0.8186513
## 2: -0.08889407 0.4514286     FSlg 48.86072 0.668855 0.5464683 0.8186513
## 3: -0.08889407 0.4514286      GRF 81.43453 0.668855 0.5464683 0.8186513
## 4:  0.02221450 0.4514286   GRF.60 48.86072 0.668855 0.5464683 0.8186513
## 5:  0.02221450 0.4514286   VT(24) 81.43453 0.668855 0.5464683 0.8186513
## 6:  0.02221450 0.4514286  VT#(24) 81.43453 0.668855 0.5464683 0.8186513
##    hr.adj.itt l.adj.itt u.adj.itt l.H.true u.H.true l.Hc.true u.Hc.true
##         <num>     <num>     <num>    <num>    <num>     <num>     <num>
## 1:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
## 2:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
## 3:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
## 4:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
## 5:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
## 6:  0.6827343 0.5565269 0.8375626 1.105971 2.752186 0.4437854 0.7009717
##     l.H.hat  u.H.hat  l.Hc.hat  u.Hc.hat
##       <num>    <num>     <num>     <num>
## 1: 1.105971 2.752186 0.4437854 0.7009717
## 2: 1.105971 2.752186 0.4437854 0.7009717
## 3: 1.105971 2.752186 0.4437854 0.7009717
## 4:       NA       NA 0.5464683 0.8186513
## 5:       NA       NA 0.5464683 0.8186513
## 6:       NA       NA 0.5464683 0.8186513
## Subgroup HRs: H, H^c, Causal= 2.000007 0.6466405 0.7057463 
## Simulations= 20000 
## Avg censoring= 0.4502911 
## Min,Max,Avg tau.max= 69.89395 83.99237 81.61975 
## P(H) approximation at causal(H), n(sg)=60, approx= 2.000007 60 0.8281929 
## P(H) approximation at causal(H), Avg(n(sg)), approx= 2.000007 89 0.8997886 
## P(H) approximation at plim(H), Avg(n(sg)), approx= 2.114003 89 0.9262042 
## Minutes,hours 491.4375 8.190625 
##                    FSl    FSlg     GRF  GRF.60  VT(24) VT#(24)  VT(36) VT#(36)
## any.H            0.910   0.860   0.940   0.720   0.490   0.540   0.470   0.610
## sensH            0.850   0.800   0.850   0.650   0.450   0.520   0.420   0.590
## sensHc           0.990   0.990   0.970   0.980   0.990   0.990   0.990   0.990
## ppH              0.840   0.790   0.780   0.610   0.440   0.510   0.410   0.570
## ppHc             0.980   0.970   0.980   0.960   0.930   0.940   0.930   0.950
## Avg(#H)         89.000  91.000 102.000  99.000  92.000  92.000  92.000  92.000
## minH            61.000  61.000  60.000  60.000  60.000  60.000  60.000  60.000
## maxH           290.000 272.000 397.000 293.000 204.000 198.000 249.000 189.000
## Avg(#Hc)       619.000 621.000 605.000 629.000 655.000 650.000 657.000 644.000
## minHc          410.000 428.000 303.000 407.000 496.000 502.000 451.000 511.000
## maxHc          700.000 700.000 700.000 700.000 700.000 700.000 700.000 700.000
## hat(H*)          2.194   2.213   2.154   2.252   2.390   2.378   2.416   2.355
## hat(hat[H])      2.228   2.204   2.018   2.066   2.284   2.308   2.290   2.304
## hat(Hc*)         0.653   0.653   0.651   0.647   0.653   0.652   0.652   0.652
## hat(hat[Hc])     0.653   0.652   0.645   0.646   0.655   0.653   0.656   0.651
## hat(H*)all       2.114   2.114   2.114   2.114   2.114   2.114   2.114   2.114
## hat(Hc*)all      0.652   0.652   0.652   0.652   0.652   0.652   0.652   0.652
## hat(ITT)all      0.755   0.755   0.755   0.755   0.755   0.755   0.755   0.755
## hat(ITTadj)all   0.742   0.742   0.742   0.742   0.742   0.742   0.742   0.742
\end{verbatim}
\begin{alltt}
\hlstd{missC}\hlkwb{<-}\hlkwd{tab_tests}\hlstd{(}\hlkwc{res}\hlstd{=res)}

\hlstd{pA} \hlkwb{<-} \hlkwd{as.character}\hlstd{(}\hlkwd{round}\hlstd{(outres}\hlopt{$}\hlstd{pAnyH.approx2,}\hlnum{4}\hlstd{))}

\hlstd{tabsim_missC}\hlkwb{<-}\hlkwd{get_tabsim}\hlstd{(}\hlkwc{missC}\hlstd{=missC,}\hlkwc{pA}\hlstd{=pA,}\hlkwc{est_names}\hlstd{=est_names,}\hlkwc{stat_names}\hlstd{=stat_names,}\hlkwc{mod.harm}\hlstd{=mod.harm,}\hlkwc{Nsims}\hlstd{=Nsims)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{table}[!h]
\centering
\caption{\label{tab:r hrh2}Average classification rates: ${avg}\vert \hat{H} \vert$, ${min}\vert \hat{H} \vert$, and ${max}\vert \hat{H} \vert$, denote the average, 
minimum, and maximum of the number of subjects in the estimated subgroup $\hat{H}$ (analogously for $\hat{H}^{c}$).  
Note that under the null $sens(\hat{H})$ is undefined and $ppv(\hat{H})=0$.}
\centering
\fontsize{9}{11}\selectfont
\begin{tabular}[t]{lcccccccc}
\toprule
  & $FS_{g}$ & $FS_{lg}$ & $GRF$ & $GRF_{60}$ & $VT(24)$ & ${VT}^{\#}(24)$ & $VT(36)$ & ${VT}^{\#}(36)$\\
\midrule
\addlinespace[0.3em]
\multicolumn{9}{l}{\textbf{Finding H}}\\
\hspace{1em}any(H) & 0.91 & 0.86 & 0.94 & 0.72 & 0.49 & 0.54 & 0.47 & 0.61\\
\hspace{1em}${sens}(\hat{H})$ & 0.85 & 0.8 & 0.85 & 0.65 & 0.45 & 0.52 & 0.42 & 0.59\\
\hspace{1em}${sens}(\hat{H}^{C})$ & 0.99 & 0.99 & 0.97 & 0.98 & 0.99 & 0.99 & 0.99 & 0.99\\
\hspace{1em}${ppv}(\hat{H})$ & 0.84 & 0.79 & 0.78 & 0.61 & 0.44 & 0.51 & 0.41 & 0.57\\
\hspace{1em}${ppv}(\hat{H}^{C})$ & 0.98 & 0.97 & 0.98 & 0.96 & 0.93 & 0.94 & 0.93 & 0.95\\
\addlinespace[0.3em]
\multicolumn{9}{l}{\textbf{Size of H and H-complement}}\\
\hspace{1em}${avg}\vert \hat{H} \vert$ & 89 & 91 & 102 & 99 & 92 & 92 & 92 & 92\\
\hspace{1em}${min}\vert \hat{H} \vert$ & 61 & 61 & 60 & 60 & 60 & 60 & 60 & 60\\
\hspace{1em}${max}\vert \hat{H} \vert$ & 290 & 272 & 397 & 293 & 204 & 198 & 249 & 189\\
\hspace{1em}${avg}\vert \hat{H}^{C} \vert$ & 619 & 621 & 605 & 629 & 655 & 650 & 657 & 644\\
\hspace{1em}${min}\vert \hat{H}^{C} \vert$ & 410 & 428 & 303 & 407 & 496 & 502 & 451 & 511\\
\hspace{1em}${max}\vert \hat{H}^{C} \vert$ & 700 & 700 & 700 & 700 & 700 & 700 & 700 & 700\\
\bottomrule
\multicolumn{9}{l}{\rule{0pt}{1em}\textit{Note: } Number of simulations= 20000 .}\\
\multicolumn{9}{l}{\rule{0pt}{1em}\textit{Note: } Probability approximation= 0.8998 .}\\
\end{tabular}
\end{table}




\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{t.done}\hlkwb{<-}\hlkwd{proc.time}\hlstd{()[}\hlnum{3}\hlstd{]}
\hlstd{t.min}\hlkwb{<-}\hlstd{(t.done}\hlopt{-}\hlstd{t.start.all)}\hlopt{/}\hlnum{60}
\hlkwd{cat}\hlstd{(}\hlstr{"Minutes and hours to finish"}\hlstd{,}\hlkwd{c}\hlstd{(t.min,t.min}\hlopt{/}\hlnum{60}\hlstd{),}\hlstr{"\textbackslash{}n"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Minutes and hours to finish 937.5919 15.62653
\end{verbatim}
\begin{alltt}
\hlkwd{cat}\hlstd{(}\hlstr{"Minutes and hours per 10,000 to finish"}\hlstd{,(}\hlnum{10000}\hlopt{/}\hlstd{Nsims)}\hlopt{*}\hlkwd{c}\hlstd{(t.min,t.min}\hlopt{/}\hlnum{60}\hlstd{),}\hlstr{"\textbackslash{}n"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Minutes and hours per 10,000 to finish 468.796 7.813266
\end{verbatim}
\begin{alltt}
\hlcom{#cat("Machine=",c(Sys.info()[[4]]),"\textbackslash{}n")}
\hlcom{#cat("Number of cores=",c(detectCores(logical = FALSE)),"\textbackslash{}n")}
\hlkwd{require}\hlstd{(benchmarkme)}
\hlstd{my_system} \hlkwb{<-} \hlkwd{get_cpu}\hlstd{()}
\hlstd{my_ram} \hlkwb{<-} \hlkwd{get_ram}\hlstd{()}
\hlkwd{cat}\hlstd{(}\hlstr{"Running on system:"}\hlstd{,}\hlkwd{c}\hlstd{(my_system}\hlopt{$}\hlstd{model_name),}\hlstr{"\textbackslash{}n"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Running on system: Apple M1 Max
\end{verbatim}
\begin{alltt}
\hlkwd{cat}\hlstd{(}\hlstr{"with number of cores and cpu/GB="}\hlstd{,}\hlkwd{c}\hlstd{(my_system}\hlopt{$}\hlstd{no_of_cores,}\hlkwd{round}\hlstd{(}\hlkwd{c}\hlstd{(my_ram)}\hlopt{/}\hlnum{10}\hlopt{^}\hlnum{9}\hlstd{,}\hlnum{0}\hlstd{)),}\hlstr{"\textbackslash{}n"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## with number of cores and cpu/GB= 10 34
\end{verbatim}
\end{kframe}
\end{knitrout}



\end{document}














