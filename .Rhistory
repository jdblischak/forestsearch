treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(0.9, 0.7, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
dgm_spline$model_params$b0
-log(4)
devtools::document()
devtools::load_all()
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_var = c("z_meno"),
beta_var = -log(4),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(0.9, 0.7, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
dgm_spline$model_params$b0
-log(4)
dgm_spline$model_params$censoring$gamma
devtools::document()
devtools::load_all()
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_var = c("z_meno"),
beta_var = -log(4),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(0.9, 0.7, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
dgm_spline$model_params$b0
names(dgm_spline$df_super)
devtools::document()
devtools::load_all()
# Simulate data
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 700,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
names(draw_spline)
result <- cox_cs_fit(
df = draw_spline, tte.name = "y.sim", event_name ="event.sim", treat_name = "treat_sim",
z_name = "z_erlog",
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y.sim", event_name ="event.sim", treat_name = "treat_sim",
z_name = "z_erlog",
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
z_name = "z_erlog",
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
log(10)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog",
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.1,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.25,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
with(draw_spline, plot(z_erlog, loghr_po, type="s", lwd=2))
devtools::document()
devtools::load_all()
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_var = c("z_meno"),
beta_var = -log(4),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(1.2, 0.9, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
plot_spline_treatment_effect(dgm_spline)
# Simulate data
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 700,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
# Simulate data
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 1000,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
dfp <- data.table::setorder(draw_spline,z_erlog)
names(draw_spline)
with(dfp, plot(z_erlog, loghr_po))
dfp <- data.table::setorder(draw_spline,z_erlog)
with(dfp, plot(z_erlog, loghr_po, type="l", lty=1
dfp <- data.table::setorder(draw_spline,z_erlog)
with(dfp, plot(z_erlog, loghr_po, type="l", lty=1))
devtools::document()
devtools::load_all()
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_var = c("z_meno"),
beta_var = -log(4),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(1.2, 0.9, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
plot_spline_treatment_effect(dgm_spline)
dgm_spline$model_params$b0
# Simulate data
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 1000,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
dfp <- data.table::setorder(draw_spline,z_erlog)
with(dfp, plot(z_erlog, loghr_po, type="l", lty=1))
is.data.table(draw_spline)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
help(legend)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
# Simulate data
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 700,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
devtools::document()
devtools::load_all()
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_beta_spec = list(set_var = c("z_meno"), beta_var = -log(4)),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(10),
zeta = log(20),
log_hrs = log(c(1.2, 0.9, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
plot_spline_treatment_effect(dgm_spline)
dgm_spline$model_params$b0
-log(4)
dgm_spline <- generate_aft_dgm_flex(
data = df_gbsg,
continuous_vars = c("age", "size", "pgr","erlog"),
factor_vars = c("meno", "grade"),
set_beta_spec = list(set_var = c("z_meno"), beta_var = -log(4)),
outcome_var = "tte",
event_var = "status",
treatment_var = "hormon",
subgroup_vars = NULL,
subgroup_cuts = NULL,
model = "alt",
spline_spec = list(
var = "z_erlog",  # Use original variable name (or "z_er" if transformed)
knot = log(5),
zeta = log(20),
log_hrs = log(c(1.5, 0.9, 0.6))  # HR varies with ER
),
k_inter = 0.0,  # Amplify meno subgroup effect
verbose = TRUE
)
dgm_spline$model_params$b0
set.seed(123)
draw_spline <- simulate_from_dgm(
dgm = dgm_spline,
n = 700,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = Inf,
seed = 123
)
result <- cox_cs_fit(
df = draw_spline, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_erlog", z_by = 0.25, z_window = 0.125,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
simulate_from_dgm
names(dgm_spline)
dgm_spline$hazard_ratios
define_subgroups
names(dgm_spline$df_super)
calculate_hazard_ratios
devtools::document()
devtools::load_all()
# Specify critical HR threshold
results <- plot_subgroup_effects(dgm_spline$df_super, hrz_crit = 0)
names(dgm_spline$df_super)
devtools::document()
devtools::load_all()
# Specify critical HR threshold
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
devtools::document()
devtools::load_all()
# Specify critical HR threshold
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
names(results)
devtools::document()
devtools::load_all()
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
devtools::document()
devtools::load_all()
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
devtools::document()
devtools::load_all()
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
devtools::document()
devtools::load_all()
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
devtools::document()
devtools::load_all()
results <- plot_subgroup_effects(dgm_spline$df_super, z ="z_erlog", hrz_crit = 0)
names(results)
with(results,plot(zpoints,AHR_zpos))
with(results,plot(zpoints,AHR_zpos, type="s", lty=1))
with(results,plot(zpoints,AHR_zneg, type="s", lty=1))
with(results,plot(zpoints,CDE_zpos, type="s", lty=1))
with(results,plot(zpoints,CDE_zneg, type="s", lty=1))
