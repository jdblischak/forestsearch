dfideal <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "t_true",
event.name = "event_mod",
treat.name = "treat_sim"
)
# non-AP
dfc0 <- df_counting(
df = subset(df_example, z_AP ==0),
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# AP
dfc1 <- df_counting(
df = subset(df_example, z_AP ==1),
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
par(mfrow=c(2,2))
plot_weighted_km(dfideal, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc0, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc1, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
# Simulate data
df_example <- simulate_from_dgm(
dgm = dgm_spline,
n = 500,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = 100,
seed = 1235
)
# ITT
dfc <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# No censoring
# Except by max_follow
df_example$t_true <- pmin(df_example$t_true, 100)
df_example$event_mod <- ifelse(df_example$t_true <= 100,1,0)
dfideal <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "t_true",
event.name = "event_mod",
treat.name = "treat_sim"
)
# non-AP
dfc0 <- df_counting(
df = subset(df_example, z_AP ==0),
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# AP
dfc1 <- df_counting(
df = subset(df_example, z_AP ==1),
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
par(mfrow=c(2,2))
plot_weighted_km(dfideal, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc0, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc1, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
result <- cox_cs_fit(
df = df_example, tte_name = "y_sim", event_name ="event_sim", treat_name = "treat_sim",
truebeta_name = "loghr_po",
z_name = "z_bm", z_by = 1, z_window = 0.5,
alpha = 0.20,
plot_params = list(
xlab = "Biomarker Level",
main_title = "Treatment Effect Heterogeneity"
)
)
confounders.name <- c("z_age","z_bm","z_male","ecog","z_region_other","z_histology","z_prior_treat","z_strat")
dfa <- as.data.frame(df_nonAP)
# Simulate data
df_example <- simulate_from_dgm(
dgm = dgm_spline,
n = 500,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = 100,
seed = 1235
)
# ITT
dfc <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# No censoring
# Except by max_follow
df_example$t_true <- pmin(df_example$t_true, 100)
df_example$event_mod <- ifelse(df_example$t_true <= 100,1,0)
dfideal <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "t_true",
event.name = "event_mod",
treat.name = "treat_sim"
)
df_nonAP <- subset(df_example, z_AP == 0)
df_AP <- subset(df_example, z_AP == 1)
# non-AP
dfc0 <- df_counting(
df = df_nonAP,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# AP
dfc1 <- df_counting(
df = df_AP,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
par(mfrow=c(2,2))
plot_weighted_km(dfideal, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc0, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
plot_weighted_km(dfc1, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
# Simulate data
df_example <- simulate_from_dgm(
dgm = dgm_spline,
n = 500,
rand_ratio = 1,
draw_treatment = TRUE,
max_follow = 100,
seed = 1235
)
# ITT
dfc <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# No censoring
# Except by max_follow
df_example$t_true <- pmin(df_example$t_true, 100)
df_example$event_mod <- ifelse(df_example$t_true <= 100,1,0)
dfideal <- df_counting(
df = df_example,
by.risk = 6,
tte.name = "t_true",
event.name = "event_mod",
treat.name = "treat_sim"
)
df_nonAP <- subset(df_example, z_AP == 0)
df_AP <- subset(df_example, z_AP == 1)
# non-AP
dfc0 <- df_counting(
df = df_nonAP,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
# AP
dfc1 <- df_counting(
df = df_AP,
by.risk = 6,
tte.name = "y_sim",
event.name = "event_sim",
treat.name = "treat_sim"
)
par(mfrow=c(2,2))
plot_weighted_km(dfideal, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
title("ITT no random censoring")
plot_weighted_km(dfc, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
title("ITT censored")
plot_weighted_km(dfc0, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
title("non-AP")
plot_weighted_km(dfc1, conf.int = FALSE, show.logrank = TRUE, ymax = 1.05)
title("AP")
confounders.name <- c("z_age","z_bm","z_male","ecog","z_region_other","z_histology","z_prior_treat","z_strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po", flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
confounders.name <- c("z_age","z_bm","z_male","ecog","region_other","histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po", flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
confounders.name <- c("z_age","z_bm","z_male","ecog","region_other","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po", flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
dim(df_nonAP)
names(df_nonAP)
fs <- forestsearch(df.analysis=df_nonAP, df.test=df_AP,
confounders.name=confounders.name,
outcome.name="y.sim", treat.name="treat.sim", event.name="event.sim",
potentialOutcome.name="loghr.po",
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.90,
sg_focus="minSG", details=TRUE,
conf_force=c("age <= 65","biomarker < 1","biomarker < 2","biomarker < 3",
"biomarker < 4","biomarker < 5","biomarker < 6","biomarker < 7","biomarker < 8",
"biomarker < 9","biomarker < 10"), exclude_cuts=c("biomarker <="), maxk=1)
fs <- forestsearch(df.analysis=df_nonAP, df.test=df_AP,
confounders.name=confounders.name,
outcome.name="y_sim", treat.name="treat_sim", event.name="event_sim",
potentialOutcome.name="loghr.po",
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.90,
sg_focus="minSG", details=TRUE,
conf_force=c("age <= 65","biomarker < 1","biomarker < 2","biomarker < 3",
"biomarker < 4","biomarker < 5","biomarker < 6","biomarker < 7","biomarker < 8",
"biomarker < 9","biomarker < 10"), exclude_cuts=c("biomarker <="), maxk=1)
fs <- forestsearch(df.analysis=df_nonAP, df.test=df_AP,
confounders.name=confounders.name,
outcome.name="y_sim", treat.name="treat_sim", event.name="event_sim",
potentialOutcome.name="loghr_po",
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.90,
sg_focus="minSG", details=TRUE,
conf_force=c("age <= 65","biomarker < 1","biomarker < 2","biomarker < 3",
"biomarker < 4","biomarker < 5","biomarker < 6","biomarker < 7","biomarker < 8",
"biomarker < 9","biomarker < 10"), exclude_cuts=c("biomarker <="), maxk=1)
names(dfa)
is.data.frame(dfa)
confounders.name
summary(dfa)
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po", flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
plan("sequential")
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
plan("sequential")
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 12, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
names(res_tabs)
help(sg_tables)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing")
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
dim(df_AP)
res_tabs$sg10_out
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = FALSE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 100, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 0.90, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = TRUE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 100, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 1.25, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = TRUE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 100, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 0.9, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = TRUE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 100, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
confounders.name <- c("z_age","z_bm","z_male","ecog","z_histology","z_prior_treat","strat")
dfa <- as.data.frame(df_nonAP)
# Setup parallel processing
library(doFuture)
library(doRNG)
registerDoFuture()
registerDoRNG()
system.time({fs <- forestsearch(dfa,  confounders.name=confounders.name,
outcome.name = "y_sim", treat.name = "treat_sim", event.name = "event_sim", id.name = "id",
potentialOutcome.name = "loghr_po",
df.test = as.data.frame(df_AP),
flag_harm.name = NULL,
hr.threshold = 1.25, hr.consistency = 0.80, pconsistency.threshold = 0.80,
sg_focus = "minSG", max_subgroups_search = 30,
showten_subgroups = TRUE, details=TRUE,
conf_force = c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2","z_bm <= 5"),
cut_type = "default", use_grf = TRUE, plot.grf = TRUE, use_lasso = TRUE,
maxk = 1, n.min = 60, d0.min = 12, d1.min = 12,
plot.sg = TRUE, by.risk = 6,
parallel_args = list(plan="callr", workers = 100, show_message = TRUE)
)
})
plan("sequential")
res_tabs <- sg_tables(fs, ndecimals = 3)
res_tabs$sg10_out
res_tabs$tab_estimates
# Testing (AP)
res_tabs <- sg_tables(fs, ndecimals = 3, which_df = "testing", est_caption = "Testing (AP) dataset")
res_tabs$tab_estimates
devtools::document()
devtools::load_all()
devtools::document()
devtools::load_all()
unlink("man/*.Rd")
devtools::document()
devtools::load_all()
