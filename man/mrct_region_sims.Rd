% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mrct_simulation.R
\name{mrct_region_sims}
\alias{mrct_region_sims}
\title{MRCT Regional Subgroup Simulation}
\usage{
mrct_region_sims(
  dgm,
  n_sims,
  n_sample = NULL,
  region_var = "z_regA",
  sg_focus = "minSG",
  maxk = 1,
  hr.threshold = 0.9,
  hr.consistency = 0.8,
  pconsistency.threshold = 0.9,
  confounders.name = NULL,
  conf_force = NULL,
  analysis_time = 60,
  cens_adjust = 0,
  parallel_args = list(plan = "multisession", workers = NULL, show_message = TRUE),
  details = FALSE,
  seed = NULL
)
}
\arguments{
\item{dgm}{Data generating mechanism object from \code{\link{generate_aft_dgm_flex}}}

\item{n_sims}{Integer. Number of simulations to run}

\item{n_sample}{Integer. Sample size per simulation. If NULL (default), uses
the entire super-population from dgm}

\item{region_var}{Character. Name of the region indicator variable used to split
data into training (region_var == 0) and testing (region_var == 1) populations.
Default: "z_regA"}

\item{sg_focus}{Character. Subgroup selection criterion passed to
\code{\link{forestsearch}}: "minSG", "hr", or "maxSG". Default: "minSG"}

\item{maxk}{Integer. Maximum number of factors in subgroup combinations (1 or 2).
Default: 1}

\item{hr.threshold}{Numeric. Hazard ratio threshold for subgroup identification.
Default: 0.90}

\item{hr.consistency}{Numeric. Consistency threshold for hazard ratio.
Default: 0.80}

\item{pconsistency.threshold}{Numeric. Probability threshold for consistency.
Default: 0.90}

\item{confounders.name}{Character vector. Confounder variable names for ForestSearch.
If NULL, automatically extracted from dgm}

\item{conf_force}{Character vector. Forced cuts to consider in ForestSearch.
Default: c("z_age <= 65", "z_bm <= 0", "z_bm <= 1", "z_bm <= 2", "z_bm <= 5")}

\item{analysis_time}{Numeric. Time of analysis for administrative censoring.
Default: 60}

\item{cens_adjust}{Numeric. Adjustment factor for censoring rate on log scale.
Default: 0}

\item{parallel_args}{List. Parallel processing configuration with components:
\itemize{
\item plan: "multisession", "multicore", "callr", or "sequential"
\item workers: Number of workers (NULL for auto-detect)
\item show_message: Logical for progress messages
}}

\item{details}{Logical. Print detailed progress information. Default: FALSE}

\item{seed}{Integer. Base random seed for reproducibility. Default: NULL}
}
\value{
A data.table with simulation results containing:
\describe{
\item{sim}{Simulation index}
\item{n_itt}{ITT sample size}
\item{hr_itt}{ITT hazard ratio (stratified if strat variable present)}
\item{hr_ittX}{ITT hazard ratio stratified by region}
\item{n_train}{Training (non-region A) sample size}
\item{hr_train}{Training population hazard ratio}
\item{n_test}{Testing (region A) sample size}
\item{hr_test}{Testing population hazard ratio}
\item{any_found}{Indicator: 1 if subgroup identified, 0 otherwise}
\item{sg_found}{Character description of identified subgroup}
\item{n_sg}{Subgroup sample size}
\item{hr_sg}{Subgroup hazard ratio}
\item{POhr_sg}{Potential outcome hazard ratio in subgroup}
\item{prev_sg}{Subgroup prevalence (proportion of testing population)}
\item{hr_sg_null}{Subgroup HR when found, NA otherwise}
}
}
\description{
Simulates multi-regional clinical trials and evaluates ForestSearch subgroup
identification. Splits data by region into training and testing populations,
identifies subgroups using ForestSearch on training data, and evaluates
performance on the testing region.
}
\details{
\subsection{Simulation Process}{

For each simulation:
\enumerate{
\item Sample from super-population using \code{\link{simulate_from_dgm}}
\item Split by region_var into training and testing populations
\item Estimate HRs in ITT, training, and testing populations
\item Run \code{\link{forestsearch}} on training population
\item Apply identified subgroup to testing population
\item Calculate subgroup-specific estimates
}
}

\subsection{Region Variable}{

The region_var parameter is used ONLY for splitting data into training/testing
populations. It does not imply any prognostic effect. To include prognostic
confounder effects, specify them when creating the DGM using
\code{\link{create_dgm_for_mrct}} or \code{\link{generate_aft_dgm_flex}}.
}
}
\examples{
\dontrun{
# Create DGM for alternative hypothesis
dgm_alt <- create_dgm_for_mrct(
  df_case = df_case,
  model_type = "alt",
  log_hrs = log(c(3, 1.25, 0.50)),
  verbose = TRUE
)

# Run simulations
results <- mrct_region_sims(
  dgm = dgm_alt,
  n_sims = 100,
  region_var = "z_regA",
  sg_focus = "minSG",
  parallel_args = list(plan = "multisession", workers = 4),
  details = TRUE
)

# Summarize results
cat("Subgroup identification rate:", mean(results$any_found) * 100, "\%\n")
}

}
\seealso{
\code{\link{forestsearch}} for subgroup identification algorithm
\code{\link{generate_aft_dgm_flex}} for DGM creation
\code{\link{simulate_from_dgm}} for data simulation
\code{\link{create_dgm_for_mrct}} for MRCT-specific DGM wrapper
\code{\link{summaryout_mrct}} for summarizing simulation results
}
