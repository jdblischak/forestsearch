% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_sg_results.R
\name{plot_sg_results}
\alias{plot_sg_results}
\title{Plot ForestSearch Subgroup Results}
\usage{
plot_sg_results(
  fs.est,
  outcome.name = "Y",
  event.name = "Event",
  treat.name = "Treat",
  plot_type = c("combined", "km", "forest", "summary"),
  by.risk = NULL,
  conf.level = 0.95,
  est.scale = c("hr", "1/hr"),
  sg0_name = "Questionable (H)",
  sg1_name = "Recommend (H^c)",
  treat_labels = c(`0` = "Control", `1` = "Treatment"),
  colors = NULL,
  title = NULL,
  show_events = TRUE,
  show_ci = TRUE,
  show_logrank = TRUE,
  show_hr = TRUE,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{fs.est}{A forestsearch object or list containing at minimum:
\describe{
\item{df.est}{Data frame with analysis data including \code{treat.recommend}}
\item{sg.harm}{Character vector of subgroup-defining variable names}
\item{grp.consistency}{Optional. Consistency results from \code{sg_consistency_out}}
}}

\item{outcome.name}{Character. Name of time-to-event outcome column.
Default: "Y"}

\item{event.name}{Character. Name of event indicator column (1=event, 0=censored).
Default: "Event"}

\item{treat.name}{Character. Name of treatment column (1=treatment, 0=control).
Default: "Treat"}

\item{plot_type}{Character. Type of plot to create. One of:
\describe{
\item{"km"}{Kaplan-Meier survival curves}
\item{"forest"}{Forest plot of hazard ratios}
\item{"summary"}{Summary statistics panel}
\item{"combined"}{All plots combined (default)}
}}

\item{by.risk}{Numeric. Risk interval for KM survival curves.
Default: NULL (auto-calculated)}

\item{conf.level}{Numeric. Confidence level for intervals. Default: 0.95}

\item{est.scale}{Character. Effect scale: "hr" (hazard ratio) or
"1/hr" (inverse). Default: "hr"}

\item{sg0_name}{Character. Label for subgroup 0 (harm/questionable).
Default: "Questionable (H)"}

\item{sg1_name}{Character. Label for subgroup 1 (recommend/complement).
Default: "Recommend (H^c)"}

\item{treat_labels}{Named character vector. Labels for treatment arms.
Default: c("0" = "Control", "1" = "Treatment")}

\item{colors}{Named character vector. Colors for plot elements.
Default: uses package defaults}

\item{title}{Character. Main plot title. Default: auto-generated}

\item{show_events}{Logical. Show event counts on KM curves. Default: TRUE}

\item{show_ci}{Logical. Show confidence intervals. Default: TRUE}

\item{show_logrank}{Logical. Show log-rank p-value. Default: TRUE}

\item{show_hr}{Logical. Show hazard ratio annotation. Default: TRUE}

\item{verbose}{Logical. Print diagnostic messages. Default: FALSE}

\item{...}{Additional arguments passed to plotting functions.}
}
\value{
An object of class \code{fs_sg_plot} containing:
\describe{
\item{plots}{List of ggplot2 or base R plot objects}
\item{summary}{Data frame of subgroup summary statistics}
\item{hr_estimates}{Data frame of hazard ratio estimates}
\item{call}{The matched call}
}
}
\description{
Creates comprehensive visualizations of subgroup results from ForestSearch,
including Kaplan-Meier survival curves, hazard ratio comparisons, and
summary statistics. This function is designed to work with the output
from \code{\link{forestsearch}}, specifically the \code{df.est} component.
}
\details{
The function extracts subgroup membership from \code{fs.est$df.est$treat.recommend}:
\itemize{
\item \code{treat.recommend == 0}: Harm/questionable subgroup (H)
\item \code{treat.recommend == 1}: Recommend/complement subgroup (H^c)
}

For \code{est.scale = "1/hr"}, treatment labels and subgroup interpretation
are reversed to maintain clinical interpretability.
}
\section{Kaplan-Meier Plots}{

When \code{plot_type = "km"}, creates side-by-side survival curves for:
\enumerate{
\item The identified subgroup (H) with treatment vs control
\item The complement subgroup (H^c) with treatment vs control
}
}

\section{Forest Plot}{

When \code{plot_type = "forest"}, creates a forest plot showing hazard
ratios with confidence intervals for: ITT population, H subgroup,
and H^c complement.
}

\examples{
\dontrun{
# Run ForestSearch analysis
fs <- forestsearch(
  df.analysis = my_data,
  outcome.name = "os_time",
  event.name = "os_event",
  treat.name = "treatment",
  confounders.name = c("age_cat", "stage", "biomarker")
)

# Create combined visualization
result <- plot_sg_results(
  fs.est = fs,
  outcome.name = "os_time",
  event.name = "os_event",
  treat.name = "treatment"
)

# View the Kaplan-Meier plots only
plot_sg_results(fs, plot_type = "km")

# Customize labels
plot_sg_results(
  fs,
  sg0_name = "High Risk",
  sg1_name = "Standard Risk",
  treat_labels = c("0" = "Placebo", "1" = "Active Drug")
)
}

}
\seealso{
\code{\link{forestsearch}} for running the subgroup analysis
\code{\link{sg_consistency_out}} for consistency evaluation
\code{\link{plot_subgroup_results_forestplot}} for publication-ready forest plots
}
