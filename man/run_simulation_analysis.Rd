% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/oc_analyses_gbsg.R
\name{run_simulation_analysis}
\alias{run_simulation_analysis}
\title{Run Single Simulation Analysis}
\usage{
run_simulation_analysis(
  sim_id,
  dgm,
  n_sample,
  max_follow = Inf,
  muC_adj = 0,
  confounders_base = c("z1", "z2", "z3", "z4", "z5", "size", "grade3"),
  n_add_noise = 0L,
  run_fs = TRUE,
  run_fs_grf = TRUE,
  run_grf = TRUE,
  fs_params = list(),
  grf_params = list(),
  cox_formula = NULL,
  cox_formula_adj = NULL,
  n_sims_total = NULL,
  seed_base = 8316951L,
  verbose = FALSE,
  verbose_n = NULL,
  debug = FALSE
)
}
\arguments{
\item{sim_id}{Integer. Simulation index for seed offset and tracking}

\item{dgm}{A DGM object from \code{\link{create_gbsg_dgm}} or similar}

\item{n_sample}{Integer. Sample size for simulation}

\item{max_follow}{Numeric. Maximum follow-up time. Default: Inf}

\item{muC_adj}{Numeric. Censoring adjustment. Default: 0}

\item{confounders_base}{Character vector. Base confounder names}

\item{n_add_noise}{Integer. Number of noise variables to add. Default: 0}

\item{run_fs}{Logical. Run ForestSearch analysis. Default: TRUE}

\item{run_fs_grf}{Logical. Run ForestSearch with GRF. Default: TRUE}

\item{run_grf}{Logical. Run standalone GRF analysis. Default: TRUE}

\item{fs_params}{List. ForestSearch parameters (overrides defaults)}

\item{grf_params}{List. GRF parameters (overrides defaults)}

\item{cox_formula}{Formula. Cox model formula for estimation}

\item{cox_formula_adj}{Formula. Adjusted Cox model formula}

\item{n_sims_total}{Integer. Total simulations (for progress display)}

\item{seed_base}{Integer. Base random seed. Default: 8316951}

\item{verbose}{Logical. Print progress. Default: FALSE}

\item{verbose_n}{Integer. Only print verbose output for first N simulations.
Default: NULL (print for all simulations when verbose = TRUE)}

\item{debug}{Logical. Print detailed debugging information. Default: FALSE}
}
\value{
A data.table with analysis results for all requested methods
}
\description{
Executes ForestSearch and/or GRF analysis on a single simulated dataset.
This is the core function called within a simulation loop.
}
\details{
\subsection{Analysis Methods}{

The function can run up to three analysis types:
\itemize{
\item \strong{FS}: ForestSearch with LASSO only
\item \strong{FSlg}: ForestSearch with LASSO + GRF variable selection
\item \strong{GRF}: Standalone GRF-based subgroup identification
}
}

\subsection{Noise Variables}{

If \code{n_add_noise > 0}, random normal noise variables are added to test
robustness against irrelevant covariates.
}

\subsection{Verbose Output}{

When \code{verbose = TRUE}, the function prints:
\itemize{
\item Simulation parameters and data summary
\item True subgroup sizes and proportions
\item Analysis progress for each method
\item Identified subgroups and HR estimates
\item Classification metrics (sensitivity, specificity, PPV, NPV)
}

Use \code{verbose_n} to limit verbose output to the first N simulations,
which is useful when running many simulations in a loop.
}
}
\examples{
\dontrun{
# Create DGM
dgm <- create_gbsg_dgm(model = "alt", k_inter = 2)

# Run single simulation with verbose output
result <- run_simulation_analysis(
  sim_id = 1,
  dgm = dgm,
  n_sample = 500,
  confounders_base = c("z1", "z2", "z3", "z4", "z5", "size", "grade3"),
  run_fs = TRUE,
  run_grf = FALSE,
  verbose = TRUE
)

# Run multiple simulations, verbose for first 3 only
results <- lapply(1:100, function(i) {
  run_simulation_analysis(
    sim_id = i,
    dgm = dgm,
    n_sample = 500,
    verbose = TRUE,
    verbose_n = 3  # Only print for sim_id <= 3
  )
})
}

}
