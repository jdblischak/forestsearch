% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/forest_search.R, R/forestsearch_helpers.R
\name{forestsearch}
\alias{forestsearch}
\alias{print.forestsearch}
\alias{summary.forestsearch}
\title{Forest Search for Subgroup Identification in Survival Analysis}
\usage{
forestsearch(
  df.analysis,
  outcome.name = "tte",
  event.name = "event",
  treat.name = "treat",
  id.name = "id",
  potentialOutcome.name = NULL,
  flag_harm.name = NULL,
  confounders.name = NULL,
  parallel_args = list(plan = "callr", workers = 6, show_message = TRUE),
  df.predict = NULL,
  df.test = NULL,
  is.RCT = TRUE,
  seedit = 8316951,
  est.scale = "hr",
  use_lasso = TRUE,
  use_grf = TRUE,
  grf_res = NULL,
  grf_cuts = NULL,
  max_n_confounders = 1000,
  grf_depth = 2,
  dmin.grf = 12,
  frac.tau = 0.6,
  conf_force = NULL,
  defaultcut_names = NULL,
  cut_type = "default",
  exclude_cuts = NULL,
  replace_med_grf = FALSE,
  cont.cutoff = 4,
  conf.cont_medians = NULL,
  conf.cont_medians_force = NULL,
  n.min = 60,
  hr.threshold = 1.25,
  hr.consistency = 1,
  sg_focus = "hr",
  fs.splits = 1000,
  m1.threshold = Inf,
  pconsistency.threshold = 0.9,
  showten_subgroups = FALSE,
  d0.min = 12,
  d1.min = 12,
  max.minutes = 3,
  minp = 0.025,
  details = FALSE,
  maxk = 2,
  by.risk = 12,
  plot.sg = FALSE,
  plot.grf = FALSE,
  max_subgroups_search = 10,
  vi.grf.min = -0.2
)

\method{print}{forestsearch}(x, ...)

\method{summary}{forestsearch}(object, ...)
}
\arguments{
\item{df.analysis}{Data frame containing the analysis dataset with required columns:
\itemize{
\item \code{Y}: Numeric. Observed survival time or time to event
\item \code{Event}: Binary (0/1). Event indicator (1 = event occurred)
\item \code{Treat}: Binary (0/1). Treatment assignment (1 = treatment, 0 = control)
\item \code{id}: Patient identifier (numeric or character)
\item Additional covariate columns for subgroup discovery
}}

\item{outcome.name}{Character. Name of outcome column. Default "tte"}

\item{event.name}{Character. Name of event column. Default "event"}

\item{treat.name}{Character. Name of treatment column. Default "treat"}

\item{id.name}{Character. Name of ID column. Default "id"}

\item{potentialOutcome.name}{Character. Potential outcome column. Default NULL}

\item{flag_harm.name}{Character. Harm flag column. Default NULL}

\item{confounders.name}{Character vector. Confounder variables}

\item{parallel_args}{List. Parallel processing arguments}

\item{df.predict}{Data frame for prediction. Default NULL}

\item{df.test}{Data frame for testing. Default NULL}

\item{is.RCT}{Logical. Is RCT? Default TRUE}

\item{seedit}{Integer. Random seed. Default 8316951}

\item{est.scale}{Character. Estimate scale. Default "hr"}

\item{use_lasso}{Logical. Use LASSO? Default TRUE}

\item{use_grf}{Logical. Use GRF? Default TRUE}

\item{grf_res}{GRF results object. Default NULL}

\item{grf_cuts}{GRF cutpoints. Default NULL}

\item{max_n_confounders}{Integer. Max confounders. Default 1000}

\item{grf_depth}{Integer. GRF depth. Default 2}

\item{dmin.grf}{Integer. Min node size. Default 12}

\item{frac.tau}{Numeric. Tau fraction. Default 0.6}

\item{conf_force}{Character vector. Force variables. Default NULL}

\item{defaultcut_names}{Character vector. Default cut variables. Default NULL}

\item{cut_type}{Character. Cut type. Default "default"}

\item{exclude_cuts}{Character vector. Exclude from cuts. Default NULL}

\item{replace_med_grf}{Logical. Replace median with GRF. Default FALSE}

\item{cont.cutoff}{Integer. Continuous cutoff. Default 4}

\item{conf.cont_medians}{Character vector. Median cut variables. Default NULL}

\item{conf.cont_medians_force}{Character vector. Force median cuts. Default NULL}

\item{n.min}{Integer. Min sample size. Default 60}

\item{hr.threshold}{Numeric. HR threshold. Default 1.25}

\item{hr.consistency}{Numeric. HR consistency. Default 1.0}

\item{sg_focus}{Character. Focus type ("hr", "maxSG", "minSG", "hrMaxSG", "hrMinSG"). Default "hr"}

\item{fs.splits}{Integer. Number of splits. Default 1000}

\item{m1.threshold}{Numeric. M1 threshold. Default Inf}

\item{pconsistency.threshold}{Numeric. Consistency threshold. Default 0.90}

\item{showten_subgroups}{Logical. Show top 10. Default FALSE}

\item{d0.min}{Integer. Min control events. Default 12}

\item{d1.min}{Integer. Min treatment events. Default 12}

\item{max.minutes}{Numeric. Max computation time. Default 3}

\item{minp}{Numeric. Min p-value. Default 0.025}

\item{details}{Logical. Show details. Default FALSE}

\item{maxk}{Integer. Max factors. Default 2}

\item{by.risk}{Integer. Risk bins. Default 12}

\item{plot.sg}{Logical. Plot subgroups. Default FALSE}

\item{plot.grf}{Logical. Plot GRF. Default FALSE}

\item{max_subgroups_search}{Integer. Max subgroups to search. Default 10}

\item{vi.grf.min}{Numeric. Min variable importance. Default -0.2}
}
\value{
A list of class "forestsearch" containing:
\describe{
\item{sg.harm}{Primary selected subgroup based on sg_focus criterion}
\item{fs.est}{Forest search point estimates and model details}
\item{grp.consistency}{Consistency evaluation results for all sg_focus options:
\itemize{
\item out_hr: Results sorted by statistical reliability
\item out_maxSG: Results sorted by size (largest first)
\item out_minSG: Results sorted by size (smallest first)
}}
\item{bias_corrected}{Bias-corrected estimates (if conf.type = "biascorrected")}
\item{bootstrap_results}{Full bootstrap distribution (if n.boot > 0)}
\item{grf_importance}{Variable importance scores from GRF}
\item{lasso_selected}{Variables selected by LASSO}
\item{subgroup_definition}{Character string defining selected subgroup}
\item{consistency_metrics}{Detailed consistency statistics}
\item{parameters}{List of all input parameters for reproducibility}
\item{computation_time}{Elapsed time for major computational steps}
}
}
\description{
Implements a comprehensive statistical framework for identifying subgroups with
differential treatment effects in survival analysis. The method combines Generalized
Random Forests (GRF) for variable selection, LASSO regularization for dimension
reduction, exhaustive combinatorial search for subgroup discovery, and bootstrap
bias correction for robust inference. The function employs split-sample validation
to ensure reproducibility and control Type I error.
}
\details{
\strong{Algorithm Overview:}
\enumerate{
\item \strong{Variable Selection}: GRF identifies variables with potential
treatment effect heterogeneity
\item \strong{Dimension Reduction}: LASSO selects most predictive variables
\item \strong{Subgroup Discovery}: Exhaustive search over combinations up to maxk
\item \strong{Consistency Validation}: Split-sample validation with n.splits iterations
\item \strong{Selection}: Choose subgroup based on sg_focus criterion
\item \strong{Inference}: Bootstrap for bias correction and confidence intervals
}

\strong{Statistical Considerations:}
\itemize{
\item Controls Type I error through split-sample validation
\item Addresses overfitting via consistency requirements
\item Handles multiple testing through validation framework
\item Provides bias-corrected estimates for selected subgroups
}

\strong{Computational Notes:}
\itemize{
\item Computation scales with: n.splits × n.boot × number of candidate subgroups
\item Parallel processing recommended for n.boot > 500
\item Memory usage proportional to data size and maxk
\item Progress bars available when details = TRUE
}
}
\examples{
\dontrun{
# Example 1: Regulatory submission with high reliability focus
result_regulatory <- forestsearch(
  df.analysis = trial_data,
  sg_focus = "hr",                    # Maximum reliability
  hr.threshold = 1.3,                 # Clinically meaningful
  hr.consistency = 1.15,              # Must maintain effect
  pconsistency.threshold = 0.95,      # Very high confidence
  n.min = 100,
  d0.min = 25,
  d1.min = 25,
  n.splits = 2000,                    # Extra validation
  conf.type = "biascorrected",
  n.boot = 1000,
  parallel = TRUE,
  seed = 123
)

# Example 2: Public health application with population focus
result_public <- forestsearch(
  df.analysis = population_data,
  sg_focus = "maxSG",                 # Maximize coverage
  hr.threshold = 1.15,                # Lower threshold
  hr.consistency = 0.95,              # Some attenuation OK
  pconsistency.threshold = 0.85,      # Moderate confidence
  n.min = 80,
  d0.min = 20,
  d1.min = 20,
  conf.type = "approximate"           # Faster computation
)

# Example 3: Biomarker discovery with specificity focus
result_biomarker <- forestsearch(
  df.analysis = biomarker_data,
  sg_focus = "hrMinSG",               # Specific + harmful
  hr.threshold = 2.0,                 # High effect required
  hr.consistency = 1.5,               # Strong validation
  pconsistency.threshold = 0.90,
  n.min = 25,                         # Allow small subgroups
  d0.min = 7,
  d1.min = 7,
  maxk = 4,                           # Complex signatures OK
  conf.type = "bootstrap",
  n.boot = 2000
)

# Example 4: Sensitivity analysis across sg_focus options
sg_options <- c("hr", "maxSG", "minSG", "hrMaxSG", "hrMinSG")
sensitivity_results <- lapply(sg_options, function(focus) {
  forestsearch(
    df.analysis = trial_data,
    sg_focus = focus,
    hr.threshold = 1.25,
    details = FALSE
  )
})

# Compare selected subgroups
comparison <- data.frame(
  sg_focus = sg_options,
  N = sapply(sensitivity_results, function(x) x$sg.harm$N),
  HR = sapply(sensitivity_results, function(x) x$sg.harm$hr),
  Pcons = sapply(sensitivity_results, function(x) x$sg.harm$Pcons)
)
print(comparison)
}

}
\references{
\itemize{
\item FDA Guidance for Industry: Enrichment Strategies for Clinical Trials
to Support Approval of Human Drugs and Biological Products (2019)
\item EMA Guideline on the investigation of subgroups in confirmatory
clinical trials (2019)
\item Athey & Imbens (2016). Recursive partitioning for heterogeneous
causal effects. PNAS.
\item Wager & Athey (2018). Estimation and inference of heterogeneous
treatment effects using random forests. JASA.
}
}
\seealso{
\code{\link{subgroup.consistency}} for consistency evaluation details
\code{\link{forestsearch_bootstrap_dofuture}} for bootstrap inference
\code{\link{sg_tables}} for results tabulation
\code{\link{plot_subgroup}} for graphical displays
}
