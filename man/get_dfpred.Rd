% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/forestsearch_helpers.R
\name{get_dfpred}
\alias{get_dfpred}
\title{Generate Prediction Dataset with Subgroup Treatment Recommendation}
\usage{
get_dfpred(df.predict, sg.harm, version = 1)
}
\arguments{
\item{df.predict}{Data frame for prediction (test or validation set).}

\item{sg.harm}{Character vector of subgroup-defining labels. Values may
be wrapped in braces and optionally negated, e.g. \code{"\{er <= 0\}"}
or \code{"!\{size <= 35\}"}. Plain column names (e.g., \code{"q3.1"})
are treated as binary indicators that must equal 1.}

\item{version}{Integer; encoding version (maintained for backward
compatibility). Default: 1.}
}
\value{
Data frame with treatment recommendation flag
(\code{treat.recommend}): 0 for harm subgroup, 1 for complement.
}
\description{
Creates a prediction dataset with a treatment recommendation flag based
on the subgroup definition. Supports both label expressions
(e.g., \code{"\{er <= 0\}"}) and bare column names (e.g., \code{"q3.1"}).
}
\details{
Each element of \code{sg.harm} is processed as follows:
\enumerate{
\item Outer braces and leading \code{!} are stripped.
\item If the result matches \code{"var op value"} (where \code{op} is
one of \code{<=}, \code{<}, \code{>=}, \code{>}, \code{==},
\code{!=}), the comparison is executed directly on
\code{df.predict[[var]]}.
\item Otherwise the expression is treated as a column name and
membership is \code{df.predict[[name]] == 1}.
}
}
\examples{
\dontrun{
# With brace-wrapped label expressions
sg <- c("{er <= 0}", "{size <= 35}")
df_out <- get_dfpred(df.predict = test_data, sg.harm = sg)

# With negation
sg_neg <- c("{er <= 0}", "!{size <= 35}")
df_neg <- get_dfpred(df.predict = test_data, sg.harm = sg_neg)

# With bare column names (binary indicators)
sg_col <- c("q1.1", "q3.1")
df_col <- get_dfpred(df.predict = encoded_data, sg.harm = sg_col)
}

}
\seealso{
\code{\link{evaluate_comparison}} for the operator-dispatch
logic, \code{\link{forestsearch}} for the main analysis function.
}
