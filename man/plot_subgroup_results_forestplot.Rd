% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_subgroup_results_forestplot.R
\name{plot_subgroup_results_forestplot}
\alias{plot_subgroup_results_forestplot}
\title{Plot Subgroup Results Forest Plot}
\usage{
plot_subgroup_results_forestplot(
  fs_results,
  df_analysis,
  subgroup_list = NULL,
  outcome.name,
  event.name,
  treat.name,
  E.name = "Experimental",
  C.name = "Control",
  est.scale = "hr",
  xlog = TRUE,
  title_text = NULL,
  arrow_text = c("Favors Experimental", "Favors Control"),
  footnote_text = c("Eg 80\% of training found SG: 70\% of B (+) also B in CV testing"),
  xlim = c(0.25, 1.5),
  ticks_at = c(0.25, 0.7, 1, 1.5),
  show_cv_metrics = TRUE,
  cv_source = c("auto", "kfold", "oob", "both"),
  posthoc_colors = c("powderblue", "beige"),
  reference_colors = c("yellow", "powderblue"),
  ci_column_spaces = 20,
  conf.level = 0.95,
  theme = NULL
)
}
\arguments{
\item{fs_results}{List. A list containing ForestSearch analysis results with elements:
\itemize{
\item \code{fs.est}: ForestSearch estimation object from \code{\link{forestsearch}}
\item \code{fs_bc}: Bootstrap bias-corrected results from
\code{\link{forestsearch_bootstrap_dofuture}}
\item \code{fs_kfold}: K-fold cross-validation results from
\code{\link{forestsearch_Kfold}} or \code{\link{forestsearch_tenfold}} (optional)
\item \code{fs_OOB}: Out-of-bag cross-validation results (optional, alternative to fs_kfold)
}}

\item{df_analysis}{Data frame. The analysis dataset with outcome, event, and treatment
variables.}

\item{subgroup_list}{List. Named list of subgroup definitions to include in the plot.
Each element should be a list with:
\itemize{
\item \code{subset_expr}: Character string for subsetting (e.g., "BM> 1")
\item \code{name}: Display name for the subgroup
\item \code{type}: Either "reference" for pre-specified or "posthoc" for identified
}}

\item{outcome.name}{Character. Name of the survival time variable.}

\item{event.name}{Character. Name of the event indicator variable.}

\item{treat.name}{Character. Name of the treatment variable.}

\item{E.name}{Character. Label for experimental arm (default: "Experimental").}

\item{C.name}{Character. Label for control arm (default: "Control").}

\item{est.scale}{Character. Estimate scale: "hr" or "1/hr" (default: "hr").}

\item{xlog}{Logical. If TRUE (default), the x-axis is plotted on a
logarithmic scale. This is standard for hazard ratio forest plots
where equal distances represent equal relative effects.}

\item{title_text}{Character. Plot title (default: NULL).}

\item{arrow_text}{Character vector of length 2. Arrow labels for forest plot
(default: c("Favors Experimental", "Favors Control")).}

\item{footnote_text}{Character vector. Footnote text for the plot explaining CV metrics
(default provides CV interpretation guidance; set to NULL to omit).}

\item{xlim}{Numeric vector of length 2. X-axis limits (default: c(0.25, 1.5)).}

\item{ticks_at}{Numeric vector. X-axis tick positions
(default: c(0.25, 0.70, 1.0, 1.5)).}

\item{show_cv_metrics}{Logical. Whether to show cross-validation metrics
(default: TRUE if fs_kfold or fs_OOB available).}

\item{cv_source}{Character. Source for CV metrics:
"auto" (default, uses both if available, otherwise whichever is present),
"kfold" (use fs_kfold only),
"oob" (use fs_OOB only), or
"both" (explicitly use both fs_kfold and fs_OOB, with K-fold first then OOB).}

\item{posthoc_colors}{Character vector. Colors for post-hoc subgroup rows
(default: c("powderblue", "beige")).}

\item{reference_colors}{Character vector. Colors for reference subgroup rows
(default: c("yellow", "powderblue")).}

\item{ci_column_spaces}{Integer. Number of spaces for the CI plot column width.
More spaces = wider CI column (default: 20).}

\item{conf.level}{Numeric. Confidence level for intervals (default: 0.95 for 95\% CI).
Used to calculate the z-multiplier as qnorm(1 - (1 - conf.level)/2).}

\item{theme}{An fs_forest_theme object from \code{create_forest_theme()}.
Use this to control plot sizing (fonts, row height, CI appearance,
CV annotation font size). Default: NULL (uses default theme).}
}
\value{
A list containing:
\describe{
\item{plot}{The forestploter grob object (can be rendered with plot())}
\item{data}{The data frame used for the forest plot}
\item{row_types}{Character vector of row types for styling reference}
\item{cv_metrics}{Cross-validation metrics text (if available)}
}
}
\description{
Generates a comprehensive forest plot showing:
\itemize{
\item ITT (Intent-to-Treat) population estimate
\item Reference subgroups (e.g., by biomarker levels)
\item Post-hoc identified subgroups with bias-corrected estimates
\item Cross-validation agreement metrics as annotations
}
}
\details{
Creates a publication-ready forest plot displaying identified subgroups with
hazard ratios, bias-corrected estimates, and cross-validation metrics.
This wrapper integrates ForestSearch results with the forestploter package.
\subsection{ForestSearch Labeling Convention}{

ForestSearch identifies subgroups based on hazard ratio thresholds:
\itemize{
\item \code{sg.harm}: Contains the definition of the "harm" or "questionable"
subgroup (H)
\item \code{treat.recommend == 0}: Patient is IN the harm subgroup (H)
\item \code{treat.recommend == 1}: Patient is in the COMPLEMENT subgroup
(Hc, typically benefit)
}

For \code{est.scale = "hr"} (searching for harm):
\itemize{
\item H (treat.recommend=0): Subgroup defined by sg.harm with elevated HR
(harm/questionable)
\item Hc (treat.recommend=1): Complement of sg.harm (potential benefit)
}

For \code{est.scale = "1/hr"} (searching for benefit):
\itemize{
\item Roles are reversed: H becomes the benefit group
}
}
}
\examples{
\dontrun{
# Load ForestSearch results
load("fs_analysis_results.Rdata")  # Contains fs.est, fs_bc, fs_kfold

# Define subgroups to display
subgroups <- list(
  bm_gt1 = list(
    subset_expr = "BM > 1",
    name = "BM > 1",
    type = "reference"
  ),
  bm_gt1_size_gt19 = list(
    subset_expr = "BM > 1 & tmrsize > 19",
    name = "BM > 1 & Tumor Size > 19",
    type = "posthoc"
  )
)

# Create the forest plot with default theme
result <- plot_subgroup_results_forestplot(
  fs_results = list(fs.est = fs.est, fs_bc = fs_bc, fs_kfold = fs_kfold),
  df_analysis = df_itt,
  subgroup_list = subgroups,
  outcome.name = "os_time",
  event.name = "os_event",
  treat.name = "combo",
  E.name = "Experimental+CT",
  C.name = "CT"
)

# Create with custom theme for larger plot
large_theme <- create_forest_theme(
  base_size = 14,
  row_padding = c(6, 4),
  cv_fontsize = 11
)

result <- plot_subgroup_results_forestplot(
  fs_results = list(fs.est = fs.est, fs_bc = fs_bc, fs_kfold = fs_kfold),
  df_analysis = df_itt,
  subgroup_list = subgroups,
  outcome.name = "os_time",
  event.name = "os_event",
  treat.name = "combo",
  theme = large_theme
)

# Display the plot
render_forestplot(result)
}

}
\seealso{
\code{\link{forestsearch}} for running the subgroup analysis
\code{\link{forestsearch_bootstrap_dofuture}} for bootstrap bias correction
\code{\link{forestsearch_Kfold}} for cross-validation
\code{\link{create_forest_theme}} for customizing plot appearance
\code{\link{render_forestplot}} for rendering the plot
}
