% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cox_spline_fit.R
\name{plot_subgroup_effects}
\alias{plot_subgroup_effects}
\title{Plot Subgroup Analysis Results}
\usage{
plot_subgroup_effects(
  df_super,
  z,
  hrz_crit = 0,
  log.hrs = NULL,
  ahr_empirical = NULL,
  plot_type = c("both", "profile", "ahr"),
  add_rug = TRUE,
  zpoints_by = 1,
  ...
)
}
\arguments{
\item{df_super}{A data frame containing subgroup analysis results with columns:
loghr_po (log hazard ratios), and optionally theta_1 and theta_0
(treatment-specific parameters)}

\item{z}{Character string specifying the column name to use as the subgroup
score (e.g., "z_age", "z_size", "subgroup"). Required.}

\item{hrz_crit}{Critical hazard ratio threshold for defining optimal subgroup.
Default is 1 (HR=1 on log scale is 0).}

\item{log.hrs}{Optional vector of reference log hazard ratios to display as
horizontal lines. Default is NULL.}

\item{ahr_empirical}{Optional empirical average hazard ratio to display.
If NULL, calculated from data. Default is NULL.}

\item{plot_type}{Character string specifying plot type: "both" (default),
"profile", or "ahr".}

\item{add_rug}{Logical indicating whether to add rug plot of z values.
Default is TRUE.}

\item{zpoints_by}{Step size for z-axis grid when calculating AHR curves.
Default is 1.}

\item{...}{Additional graphical parameters passed to plot()}
}
\value{
A list containing:
\item{cut.zero}{The minimum z value where loghr_po < hrz_crit}
\item{AHR_opt}{Average hazard ratio for optimal subgroup (z >= cut.zero)}
\item{zpoints}{Grid of z values used for AHR calculations}
\item{HR.zpoints}{AHR for population with z >= zpoints}
\item{HRminus.zpoints}{AHR for population with z <= zpoints}
\item{HR2.zpoints}{Alternative AHR calculation for z >= zpoints}
\item{HRminus2.zpoints}{Alternative AHR calculation for z <= zpoints}
}
\description{
Creates diagnostic plots for subgroup treatment effects from df_super object
}
\details{
The function creates up to two plots:
\enumerate{
\item Treatment effect profile: Shows log hazard ratio as function of z
\item Average hazard ratio curve: Shows AHR for subgroups z >= threshold
}

The "optimal" subgroup is defined as patients with z >= cut.zero, where
cut.zero is the minimum z value with favorable treatment effect (loghr < hrz_crit).
}
\examples{
\dontrun{
# Using z_age as the subgroup score
results <- plot_subgroup_effects(dgm_spline$df_super, z = "z_age", hrz_crit = 0)

# Using subgroup identifier
results <- plot_subgroup_effects(dgm_spline$df_super, z = "subgroup", hrz_crit = 0)

# With reference lines
results <- plot_subgroup_effects(dgm_spline$df_super, z = "z_size",
                                  hrz_crit = 0,
                                  log.hrs = c(-0.5, 0, 0.5))

# Only AHR plot
results <- plot_subgroup_effects(dgm_spline$df_super, z = "z_pgr",
                                  plot_type = "ahr")
}

}
