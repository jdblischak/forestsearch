% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/format_subgroup_summary_tables.R
\name{create_factor_summary_tables}
\alias{create_factor_summary_tables}
\title{Create Factor Summary Tables from Bootstrap Results}
\usage{
create_factor_summary_tables(factor_freq, n_found, min_percent = 2)
}
\arguments{
\item{factor_freq}{Data.frame or data.table. Factor frequency table from
\code{\link{summarize_bootstrap_subgroups}}, containing columns:
\itemize{
\item \code{Position}: Position identifier (e.g., "M.1", "M.2")
\item \code{Factor}: Factor definition string
\item \code{N}: Count of times factor appeared in this position
\item \code{Percent}: Percentage relative to times position was populated
}}

\item{n_found}{Integer. Number of successful bootstrap iterations (where a
subgroup was identified). Used to calculate overall percentages.}

\item{min_percent}{Numeric. Minimum percentage threshold for including factors
in the tables. Factors with selection frequencies below this threshold are
excluded. Default is 2 (i.e., 2\%).}
}
\value{
A list with up to two GT table objects:
\describe{
\item{\code{by_position}}{GT table showing factor frequencies within each
position. Percentages represent conditional probability of factor selection
given that the position was populated. Within each position, percentages
sum to approximately 100\% (may not sum exactly to 100\% after filtering).}
\item{\code{overall}}{GT table showing total factor frequencies across all
positions. Includes additional columns indicating which positions each
factor appeared in and how many unique positions used the factor.
Percentages represent proportion of successful iterations where the factor
appeared in any position.}
}

If no factors meet the minimum threshold, the corresponding table element
will be NULL.
}
\description{
Generates formatted GT tables summarizing factor frequencies from bootstrap
subgroup analysis. Creates two complementary tables: one showing factor
selection frequencies within each position (M.1, M.2, etc.), and another
showing overall factor frequencies across all positions.
}
\details{
The function creates two complementary views of factor selection patterns.

\strong{Position-Specific Table (by_position):}

Shows factor selection conditional on position being populated. Percentages
are calculated as (Count in position / Total times position used) × 100.
This answers: "When position M.x was used, which factors were selected?"
Useful for understanding position-specific factor preferences.

\strong{Overall Table (overall):}

Shows total factor appearances across all positions. Percentages are
calculated as (Total appearances / Successful iterations) × 100. This
answers: "How often did this factor appear in any position?" Useful for
identifying the most important predictive factors overall. Includes
information about which positions used each factor.

\strong{Filtering Behavior:}

The \code{min_percent} parameter filters factors in both tables. For the
position-specific table, filtering is applied to the position-conditional
percentage. For the overall table, filtering is applied to the overall
percentage. This may result in different factors appearing in each table.
After filtering, percentages within positions may not sum to 100\%.

\strong{Interpretation Guidelines:}
\itemize{
\item A factor appearing in multiple positions indicates strong predictive value
\item High overall percentage + multiple positions = core predictive factor
\item High percentage in one position only = position-specific importance
\item Factors with low percentages may still be clinically meaningful
}

\strong{Statistical Interpretation:}

Position-specific percentages represent conditional probabilities:
P(Factor | Position used) = Count / Times position used

Overall percentages represent marginal probabilities:
P(Factor appears) = Total appearances / Successful iterations

Note that overall percentages can sum to more than 100\% because a single
iteration may include the same factor in multiple positions, or different
factors in different positions.
}
\note{
This function requires the \pkg{gt} package for table creation. The overall
table also requires \pkg{dplyr} for data aggregation. If \pkg{dplyr} is not
available, only the position-specific table will be created and the overall
element will be NULL.

Always check for NULL before using the returned tables:
\preformatted{
if (!is.null(factor_tables$by_position)) {
  print(factor_tables$by_position)
}
}

If all factors have percentages below \code{min_percent}, both table elements
will be NULL.
}
\section{GT Table Styling}{

The returned GT tables include professional formatting:
\itemize{
\item Bold titles with descriptive subtitles
\item Formatted percentage columns (1 decimal place)
\item Alternating row shading by position (position-specific table)
\item Green highlighting for high-frequency factors (>50\% in overall table)
\item Informative footnotes explaining the metrics
\item Source notes describing filtering criteria
}
}

\section{Output Structure}{

\strong{Position-Specific Table (by_position):}
\tabular{lll}{
\strong{Column} \tab \strong{Type} \tab \strong{Description} \cr
Position \tab character \tab Position identifier (M.1, M.2, M.3) \cr
Factor \tab character \tab Factor definition string \cr
Count \tab integer \tab Number of times factor selected in position \cr
\% When Used \tab numeric \tab Percentage of times position was populated \cr
}

\strong{Overall Table (overall):}
\tabular{lll}{
\strong{Column} \tab \strong{Type} \tab \strong{Description} \cr
Rank \tab integer \tab Rank by total count (descending) \cr
Factor \tab character \tab Factor definition string \cr
Total Count \tab integer \tab Total appearances across all positions \cr
\% of Successful \tab numeric \tab Percentage of successful iterations \crPositions \tab integer \tab Number of unique positions used \cr

Found In \tab character \tab Comma-separated list of positions \cr
}
}

\section{Factor Importance Patterns}{

By comparing the two tables, you can identify different patterns:

\strong{Pattern 1 - Universal Importance:}
\itemize{
\item High percentage in overall table (>50\%)
\item Appears in multiple positions (# Positions > 1)
\item Interpretation: Core predictive factor, consistently identified
}

\strong{Pattern 2 - Position-Specific Importance:}
\itemize{
\item High percentage in one position (>60\%)
\item Moderate percentage in overall table
\item Appears in only one position (# Positions = 1)
\item Interpretation: Important for specific position/complexity level
}

\strong{Pattern 3 - Secondary Factor:}
\itemize{
\item Low-moderate percentage in position-specific (10-40\%)
\item Low percentage in overall table (<20\%)
\item May appear in multiple positions but not dominantly
\item Interpretation: Occasionally selected, lower priority
}
}

\examples{
\dontrun{
# Basic usage
library(ForestSearch)
data(gbsg)

# Run bootstrap analysis
boot_results <- forestsearch_bootstrap_dofuture(
  data = gbsg,
  nb_boots = 1000,
  n_cores = 8
)

# Create subgroup summary
summary <- summarize_bootstrap_results(
  sgharm = NULL,
  boot_results = boot_results
)

# Generate factor summary tables
factor_tables <- create_factor_summary_tables(
  factor_freq = summary$subgroup_summary$factor_freq,
  n_found = summary$subgroup_summary$n_found,
  min_percent = 2
)

# View tables
print(factor_tables$by_position)
print(factor_tables$overall)

# Save tables as HTML
if (!is.null(factor_tables$by_position)) {
  gt::gtsave(factor_tables$by_position, "factor_by_position.html")
}

if (!is.null(factor_tables$overall)) {
  gt::gtsave(factor_tables$overall, "factor_overall.html")
}

# Use different threshold for stricter filtering
factor_tables_strict <- create_factor_summary_tables(
  factor_freq = summary$subgroup_summary$factor_freq,
  n_found = summary$subgroup_summary$n_found,
  min_percent = 10
)

# Integrate with full workflow
tables <- format_subgroup_summary_tables(
  subgroup_summary = summary$subgroup_summary,
  nb_boots = 1000
)

factor_tables <- create_factor_summary_tables(
  factor_freq = summary$subgroup_summary$factor_freq,
  n_found = summary$subgroup_summary$n_found,
  min_percent = 2
)

tables$factor_freq <- factor_tables$by_position
tables$factor_overall <- factor_tables$overall

# Custom styling example
if (!is.null(factor_tables$overall)) {
  factor_tables$overall <- factor_tables$overall |>
    gt::tab_style(
      style = gt::cell_fill(color = "#e3f2fd"),
      locations = gt::cells_body(
        columns = c(Factor, N_positions),
        rows = N_positions > 1
      )
    )
}
}

}
\seealso{
\itemize{
\item \code{\link{summarize_bootstrap_subgroups}} for generating the factor_freq input
\item \code{\link{format_subgroup_summary_tables}} for creating all subgroup summary tables
\item \code{\link{summarize_bootstrap_results}} for complete bootstrap analysis workflow
\item \code{\link{forestsearch_bootstrap_dofuture}} for running bootstrap analysis
}
}
\concept{bootstrap summary functions}
\concept{table formatting functions}
\keyword{bootstrap}
\keyword{subgroups}
\keyword{tables}
