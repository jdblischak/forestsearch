% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_sg_weighted_km.R
\name{plot_sg_weighted_km}
\alias{plot_sg_weighted_km}
\title{Plot Weighted Kaplan-Meier Curves for ForestSearch Subgroups}
\usage{
plot_sg_weighted_km(
  fs.est,
  fs_bc = NULL,
  outcome.name = "Y",
  event.name = "Event",
  treat.name = "Treat",
  by.risk = NULL,
  sg0_name = NULL,
  sg1_name = NULL,
  conf.int = TRUE,
  show.logrank = TRUE,
  show.cox = TRUE,
  show.cox.bc = TRUE,
  put.legend.lr = "topleft",
  ymax = 1.05,
  xmed.fraction = 0.65,
  hr_bc_position = "bottomright",
  hr_bc_cex = 0.725,
  title = NULL,
  verbose = FALSE
)
}
\arguments{
\item{fs.est}{A forestsearch object containing \code{df.est} with
\code{treat.recommend} column, or a data frame directly.}

\item{fs_bc}{Optional. Bootstrap results from \code{forestsearch_bootstrap_dofuture()}
containing bias-corrected HR estimates. If provided, bias-corrected HRs
will be annotated on the plots.}

\item{outcome.name}{Character. Name of time-to-event column.
Default: \code{"Y"}}

\item{event.name}{Character. Name of event indicator column.
Default: \code{"Event"}}

\item{treat.name}{Character. Name of treatment column.
Default: \code{"Treat"}}

\item{by.risk}{Numeric. Risk interval for plotting. Default: \code{NULL}
(auto-calculated as max(outcome)/12)}

\item{sg0_name}{Character. Label for H subgroup (treat.recommend == 0).
Default: \code{NULL} (auto-extracted from forestsearch object as
"H: \{definition\}" or "Questionable (H)" if not available)}

\item{sg1_name}{Character. Label for Hc subgroup (treat.recommend == 1).
Default: \code{NULL} (auto-generated as "Hc: NOT \{definition\}" or
"Recommend (Hc)" if not available)}

\item{conf.int}{Logical. Show confidence intervals. Default: \code{TRUE}}

\item{show.logrank}{Logical. Show log-rank test. Default: \code{TRUE}}

\item{show.cox}{Logical. Show unadjusted Cox HR from weightedsurv.
Default: \code{TRUE}}

\item{show.cox.bc}{Logical. Show bootstrap bias-corrected HR annotation
(requires \code{fs_bc}). Default: \code{TRUE}}

\item{put.legend.lr}{Character. Legend position. Default: "topleft"}

\item{ymax}{Numeric. Max y-axis value. Default: 1.05}

\item{xmed.fraction}{Numeric. Fraction for median lines. Default: 0.65}

\item{hr_bc_position}{Character. Position for bias-corrected HR annotation.
One of "bottomright", "bottomleft", "topright", "topleft".
Default: "bottomright"}

\item{hr_bc_cex}{Numeric. Character expansion factor for bias-corrected HR
annotation text. Default: 0.725 (matches weightedsurv cox.cex default)}

\item{title}{Character. Overall plot title. Default: \code{NULL}}

\item{verbose}{Logical. Print diagnostic messages. Default: \code{FALSE}}
}
\value{
Invisibly returns a list with subgroup data frames and counting data
}
\description{
Creates weighted Kaplan-Meier survival curves for the identified subgroups
(H and Hc) using the weightedsurv package, matching the pattern used in
\code{sg_consistency_out()}.
}
\details{
This function uses the exact same calling pattern as \code{plot_subgroup()}
in the ForestSearch package. Column names are mapped internally to the
standard names (Y, Event, Treat) expected by weightedsurv.

Subgroup definitions are automatically extracted from the forestsearch
object if available:
\itemize{
\item \code{fs$grp.consistency$out_sg$sg.harm_label} - Human-readable labels
\item \code{fs$sg.harm} - Technical factor names (fallback)
}

HR display options controlled by \code{show.cox} and \code{show.cox.bc}:
\itemize{
\item Both TRUE (default): Shows unadjusted HR from weightedsurv AND
bias-corrected HR annotation
\item \code{show.cox = TRUE, show.cox.bc = FALSE}: Shows only unadjusted HR
\item \code{show.cox = FALSE, show.cox.bc = TRUE}: Shows only bias-corrected HR
\item Both FALSE: Shows neither HR estimate
}
}
\examples{
\dontrun{
# After running forestsearch - auto-extracts subgroup definition
plot_sg_weighted_km(fs.est = fs)

# With bootstrap bias-corrected estimates
plot_sg_weighted_km(fs.est = fs, fs_bc = fs_bootstrap)

# With custom column names
plot_sg_weighted_km(
  fs.est = fs,
  outcome.name = "time_months",
  event.name = "status",
  treat.name = "hormon"
)
}

}
